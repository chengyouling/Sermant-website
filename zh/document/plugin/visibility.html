<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>服务可见性 | Sermant</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.svg">
    <meta name="description" content="基于Java字节码增强技术的云原生无代理服务网格">
    
    <link rel="preload" href="/assets/css/0.styles.b3162cc2.css" as="style"><link rel="preload" href="/assets/js/app.66cb36cf.js" as="script"><link rel="preload" href="/assets/js/3.06f127bc.js" as="script"><link rel="preload" href="/assets/js/1.c8bacf5b.js" as="script"><link rel="preload" href="/assets/js/106.b52c0d7f.js" as="script"><link rel="prefetch" href="/assets/js/10.f816289d.js"><link rel="prefetch" href="/assets/js/100.c5222045.js"><link rel="prefetch" href="/assets/js/101.62439e5a.js"><link rel="prefetch" href="/assets/js/102.a27d8e53.js"><link rel="prefetch" href="/assets/js/103.f8de76a4.js"><link rel="prefetch" href="/assets/js/104.f80bb6e4.js"><link rel="prefetch" href="/assets/js/105.69ff8068.js"><link rel="prefetch" href="/assets/js/107.f7c98a40.js"><link rel="prefetch" href="/assets/js/108.e78328e8.js"><link rel="prefetch" href="/assets/js/109.a5c6fa75.js"><link rel="prefetch" href="/assets/js/11.592204d9.js"><link rel="prefetch" href="/assets/js/110.8c6d75d8.js"><link rel="prefetch" href="/assets/js/111.94ec9618.js"><link rel="prefetch" href="/assets/js/112.a1c7e784.js"><link rel="prefetch" href="/assets/js/113.3a6cd601.js"><link rel="prefetch" href="/assets/js/114.0cd0adff.js"><link rel="prefetch" href="/assets/js/12.fd6a031f.js"><link rel="prefetch" href="/assets/js/13.7e37daca.js"><link rel="prefetch" href="/assets/js/14.199c38f6.js"><link rel="prefetch" href="/assets/js/15.900a8374.js"><link rel="prefetch" href="/assets/js/16.dc00a508.js"><link rel="prefetch" href="/assets/js/17.0b3f1b07.js"><link rel="prefetch" href="/assets/js/18.e82f1d64.js"><link rel="prefetch" href="/assets/js/19.089fd575.js"><link rel="prefetch" href="/assets/js/20.bac96cfe.js"><link rel="prefetch" href="/assets/js/21.77bca9b4.js"><link rel="prefetch" href="/assets/js/22.43cc7ae1.js"><link rel="prefetch" href="/assets/js/23.80aecc10.js"><link rel="prefetch" href="/assets/js/24.96ad3256.js"><link rel="prefetch" href="/assets/js/25.ece41e63.js"><link rel="prefetch" href="/assets/js/26.fe2d3037.js"><link rel="prefetch" href="/assets/js/27.09e84572.js"><link rel="prefetch" href="/assets/js/28.a7eceeb5.js"><link rel="prefetch" href="/assets/js/29.b0ddb50b.js"><link rel="prefetch" href="/assets/js/30.0cce24ae.js"><link rel="prefetch" href="/assets/js/31.5a0cda15.js"><link rel="prefetch" href="/assets/js/32.091bfc64.js"><link rel="prefetch" href="/assets/js/33.56d800c8.js"><link rel="prefetch" href="/assets/js/34.d8960a15.js"><link rel="prefetch" href="/assets/js/35.4d936c34.js"><link rel="prefetch" href="/assets/js/36.69b2f3fb.js"><link rel="prefetch" href="/assets/js/37.f1740a13.js"><link rel="prefetch" href="/assets/js/38.6f11668f.js"><link rel="prefetch" href="/assets/js/39.d8101f9f.js"><link rel="prefetch" href="/assets/js/4.7add7152.js"><link rel="prefetch" href="/assets/js/40.55cec7c8.js"><link rel="prefetch" href="/assets/js/41.ee37f503.js"><link rel="prefetch" href="/assets/js/42.c6aa5076.js"><link rel="prefetch" href="/assets/js/43.d8850573.js"><link rel="prefetch" href="/assets/js/44.ef4e02ab.js"><link rel="prefetch" href="/assets/js/45.cb46aba8.js"><link rel="prefetch" href="/assets/js/46.5362eeb2.js"><link rel="prefetch" href="/assets/js/47.706a7dbb.js"><link rel="prefetch" href="/assets/js/48.098a121c.js"><link rel="prefetch" href="/assets/js/49.0d4508d4.js"><link rel="prefetch" href="/assets/js/5.4a333fb7.js"><link rel="prefetch" href="/assets/js/50.0a891537.js"><link rel="prefetch" href="/assets/js/51.722c3a8c.js"><link rel="prefetch" href="/assets/js/52.42c3e36e.js"><link rel="prefetch" href="/assets/js/53.4d4b62c4.js"><link rel="prefetch" href="/assets/js/54.910bbc3e.js"><link rel="prefetch" href="/assets/js/55.ef62bf5d.js"><link rel="prefetch" href="/assets/js/56.a2f0ad08.js"><link rel="prefetch" href="/assets/js/57.7ae275a3.js"><link rel="prefetch" href="/assets/js/58.e099ee60.js"><link rel="prefetch" href="/assets/js/59.f1548879.js"><link rel="prefetch" href="/assets/js/6.15fb8f73.js"><link rel="prefetch" href="/assets/js/60.5e0c0e43.js"><link rel="prefetch" href="/assets/js/61.2fcdfd0d.js"><link rel="prefetch" href="/assets/js/62.4125fce4.js"><link rel="prefetch" href="/assets/js/63.2df510d9.js"><link rel="prefetch" href="/assets/js/64.bf0e2ff3.js"><link rel="prefetch" href="/assets/js/65.f2a51b68.js"><link rel="prefetch" href="/assets/js/66.a99035ff.js"><link rel="prefetch" href="/assets/js/67.349bf041.js"><link rel="prefetch" href="/assets/js/68.df035518.js"><link rel="prefetch" href="/assets/js/69.1dec059d.js"><link rel="prefetch" href="/assets/js/7.698dd478.js"><link rel="prefetch" href="/assets/js/70.291db580.js"><link rel="prefetch" href="/assets/js/71.bcdac895.js"><link rel="prefetch" href="/assets/js/72.9490e30b.js"><link rel="prefetch" href="/assets/js/73.9afc2fcf.js"><link rel="prefetch" href="/assets/js/74.cc2dec6d.js"><link rel="prefetch" href="/assets/js/75.83cc918a.js"><link rel="prefetch" href="/assets/js/76.fcbe5122.js"><link rel="prefetch" href="/assets/js/77.e0748d7d.js"><link rel="prefetch" href="/assets/js/78.61a9dc3a.js"><link rel="prefetch" href="/assets/js/79.9e1e5534.js"><link rel="prefetch" href="/assets/js/8.10750ce9.js"><link rel="prefetch" href="/assets/js/80.a56d59b3.js"><link rel="prefetch" href="/assets/js/81.d4686ffc.js"><link rel="prefetch" href="/assets/js/82.15dd6827.js"><link rel="prefetch" href="/assets/js/83.351db1d0.js"><link rel="prefetch" href="/assets/js/84.0beeefe9.js"><link rel="prefetch" href="/assets/js/85.4e63bf7f.js"><link rel="prefetch" href="/assets/js/86.f838230c.js"><link rel="prefetch" href="/assets/js/87.2313d286.js"><link rel="prefetch" href="/assets/js/88.58ac31af.js"><link rel="prefetch" href="/assets/js/89.7f53e214.js"><link rel="prefetch" href="/assets/js/9.7f57e4b0.js"><link rel="prefetch" href="/assets/js/90.9504d33c.js"><link rel="prefetch" href="/assets/js/91.c06cd226.js"><link rel="prefetch" href="/assets/js/92.f3d43255.js"><link rel="prefetch" href="/assets/js/93.aab26eed.js"><link rel="prefetch" href="/assets/js/94.34ece11b.js"><link rel="prefetch" href="/assets/js/95.a860fae9.js"><link rel="prefetch" href="/assets/js/96.d0a8bbd1.js"><link rel="prefetch" href="/assets/js/97.52cdde37.js"><link rel="prefetch" href="/assets/js/98.2c0724e6.js"><link rel="prefetch" href="/assets/js/99.42c86925.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b3162cc2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/img/sermant-logo.png" alt="Sermant" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/document/" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/zh/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/visibility.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/visibility.html" class="nav-link">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/document/" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/zh/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/visibility.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/visibility.html" class="nav-link">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开始</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>用户使用手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>插件使用手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/document/plugin/" aria-current="page" class="sidebar-link">插件介绍</a></li><li><a href="/zh/document/plugin/dynamic-config.html" class="sidebar-link">动态配置</a></li><li><a href="/zh/document/plugin/springboot-registry.html" class="sidebar-link">SpringBoot 注册</a></li><li><a href="/zh/document/plugin/register-migration.html" class="sidebar-link">注册迁移</a></li><li><a href="/zh/document/plugin/flowcontrol.html" class="sidebar-link">流控</a></li><li><a href="/zh/document/plugin/graceful.html" class="sidebar-link">无损上下线</a></li><li><a href="/zh/document/plugin/removal.html" class="sidebar-link">离群实例摘除</a></li><li><a href="/zh/document/plugin/loadbalancer.html" class="sidebar-link">负载均衡</a></li><li><a href="/zh/document/plugin/router.html" class="sidebar-link">标签路由</a></li><li><a href="/zh/document/plugin/tag-transmission.html" class="sidebar-link">流量标签透传</a></li><li><a href="/zh/document/plugin/monitor.html" class="sidebar-link">监控</a></li><li><a href="/zh/document/plugin/visibility.html" aria-current="page" class="active sidebar-link">服务可见性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#术语" class="sidebar-link">术语</a></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#功能介绍" class="sidebar-link">功能介绍</a></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#参数配置" class="sidebar-link">参数配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#sermant-agent配置" class="sidebar-link">Sermant Agent配置</a></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#插件配置" class="sidebar-link">插件配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#支持版本与限制" class="sidebar-link">支持版本与限制</a></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#操作和结果验证" class="sidebar-link">操作和结果验证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#_1-准备工作" class="sidebar-link">1 准备工作</a></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#_2-获取demo二进制产物" class="sidebar-link">2 获取Demo二进制产物</a></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#_3-修改配置" class="sidebar-link">3 修改配置</a></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#_4-启动应用" class="sidebar-link">4 启动应用</a></li><li class="sidebar-sub-header"><a href="/zh/document/plugin/visibility.html#_5-验证" class="sidebar-link">5 验证</a></li></ul></li></ul></li><li><a href="/zh/document/plugin/mq-consume-prohibition.html" class="sidebar-link">消息队列禁止消费</a></li><li><a href="/zh/document/plugin/database-write-prohibition.html" class="sidebar-link">数据库禁写</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发者指南</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>加入社区</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="服务可见性"><a href="#服务可见性" class="header-anchor">#</a> 服务可见性</h1> <p>本文介绍如何使用<a href="https://github.com/sermant-io/Sermant/tree/develop/sermant-plugins/sermant-service-visibility" target="_blank" rel="noopener noreferrer">服务可见性插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="术语"><a href="#术语" class="header-anchor">#</a> 术语</h2> <table><thead><tr><th>术语</th> <th>说明</th></tr></thead> <tbody><tr><td>契约信息</td> <td>服务对外提供的接口信息，包括接口所属类、请求路径、方法名、参数列表、返回类型</td></tr> <tr><td>调用依赖关系信息</td> <td>服务之间的调用关系信息，包括服务提供者和服务消费者的IP、端口信息</td></tr></tbody></table> <h2 id="功能介绍"><a href="#功能介绍" class="header-anchor">#</a> 功能介绍</h2> <p>服务可见性插件可以采集Spring Cloud和Dubbo应用的契约信息和调用依赖关系，在不修改代码的前提下可以通过Backend查看所有服务对外提供的接口信息以及服务之间的调用关系信息。</p> <p>本插件基于Spring Cloud和Dubbo应用的服务注册、服务订阅等功能完成服务注册的接口信息以及服务订阅时的提供者信息的采集，以便于用户统一管理。</p> <h2 id="参数配置"><a href="#参数配置" class="header-anchor">#</a> 参数配置</h2> <h3 id="sermant-agent配置"><a href="#sermant-agent配置" class="header-anchor">#</a> Sermant Agent配置</h3> <p>服务可见性插件需要在Sermant Agent的配置文件<code>${path}/sermant-agent-x.x.x/agent/config/config.properties</code>中配置心跳开关（<code>agent.service.heartbeat.enable</code>）、网关开关（<code>agent.service.gateway.enable</code>）、通知开关（<code>notification.enable</code>)以及服务元数据（<code>service.meta.*</code>）。</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">agent.service.heartbeat.enable</span><span class="token punctuation">=</span><span class="token value attr-value">false # 心跳开关，控制心跳功能是否开启。可见性插件依赖于心跳功能监听服务是否下线，服务下线时不展示该服务的可见性信息。默认为false：关闭，使用时需要设置为true：开启。</span>
<span class="token key attr-name">agent.service.gateway.enable</span><span class="token punctuation">=</span><span class="token value attr-value">false   # 网关开关，控制消息发送功能是否开启。可见性插件依赖于消息发送功能插件通过消息发送功能将采集到的信息发送给Backend进行展示。默认为false：关闭，使用时需要设置为true：开启。</span>
<span class="token key attr-name">notification.enable</span><span class="token punctuation">=</span><span class="token value attr-value">false            # 通知开关，控制Netty链接等通知的开关。可见性插件依赖于Netty链接的通知监听Netty是否重连。Netty重连时可见性插件会把采集的可见性数据给Backend重新发送一份，防止Backend重启导致数据丢失。默认为false：关闭，使用时需要设置为true：开启。</span>
<span class="token key attr-name">service.meta.application</span><span class="token punctuation">=</span><span class="token value attr-value">default     # 指定应用名称。服务可见性插件采集该信息用于数据展示。</span>
<span class="token key attr-name">service.meta.version</span><span class="token punctuation">=</span><span class="token value attr-value">1.0.0           # 指定服务版本。服务可见性插件采集该信息用于数据展示。</span>
<span class="token key attr-name">service.meta.project</span><span class="token punctuation">=</span><span class="token value attr-value">default         # 指定服务命名空间。服务可见性插件采集该信息用于数据展示。</span>
<span class="token key attr-name">service.meta.environment</span><span class="token punctuation">=</span>            <span class="token value attr-value"># 指定服务所在环境。服务可见性插件采集该信息用于数据展示。</span>
<span class="token key attr-name">service.meta.zone</span><span class="token punctuation">=</span>                   <span class="token value attr-value"># 指定服务所在az（可用区）。服务可见性插件采集该信息用于数据展示。</span>
</code></pre></div><h3 id="插件配置"><a href="#插件配置" class="header-anchor">#</a> 插件配置</h3> <p>服务可见性插件需要开启采集开关，可在<code>${path}/sermant-agent-x.x.x/agent/pluginPackage/service-visibility/config/config.yaml</code>找到该插件的配置文件，配置如下所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">visibility.config</span><span class="token punctuation">:</span>
  <span class="token key atrule">startFlag</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token comment"># 服务可见性采集开关。控制是否需要进行指标采集上报。为true时插件进行数据采集上报，为false时则不进行数据采集上报。</span>
</code></pre></div><table><thead><tr><th style="text-align:center;">参数键</th> <th style="text-align:center;">说明</th> <th style="text-align:center;">默认值</th> <th style="text-align:center;">是否必须</th></tr></thead> <tbody><tr><td style="text-align:center;">visibility.config.startFlag</td> <td style="text-align:center;">服务可见性采集开关</td> <td style="text-align:center;">false</td> <td style="text-align:center;">是</td></tr></tbody></table> <h2 id="支持版本与限制"><a href="#支持版本与限制" class="header-anchor">#</a> 支持版本与限制</h2> <p>框架支持：</p> <ul><li>SpringBoot 1.5.10.Release及以上</li> <li>Dubbo 2.6.x-2.7.x</li></ul> <h2 id="操作和结果验证"><a href="#操作和结果验证" class="header-anchor">#</a> 操作和结果验证</h2> <p>下面将演示如何使用服务可见性插件，验证采集Dubbo应用的契约和调用依赖关系信息场景。</p> <h3 id="_1-准备工作"><a href="#_1-准备工作" class="header-anchor">#</a> 1 准备工作</h3> <ul><li><a href="https://github.com/sermant-io/Sermant/releases/download/v2.0.0/sermant-2.0.0.tar.gz" target="_blank" rel="noopener noreferrer">下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Sermant Release包（当前版本推荐2.0.0版本）</li> <li><a href="https://github.com/sermant-io/Sermant-examples/releases/download/v2.0.0/sermant-examples-visibility-demo-2.0.0.tar.gz" target="_blank" rel="noopener noreferrer">下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Demo二进制产物压缩包</li> <li><a href="https://zookeeper.apache.org/releases.html#download" target="_blank" rel="noopener noreferrer">下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ZooKeeper（动态配置中心&amp;注册中心），并启动</li></ul> <h3 id="_2-获取demo二进制产物"><a href="#_2-获取demo二进制产物" class="header-anchor">#</a> 2 获取Demo二进制产物</h3> <p>解压Demo二进制产物压缩包，即可得到<code>dubbo-integration-consumer.jar</code>和<code>dubbo-integration-provider.jar</code>。</p> <h3 id="_3-修改配置"><a href="#_3-修改配置" class="header-anchor">#</a> 3 修改配置</h3> <ul><li>修改Sermant Agent配置
在<code>${path}/sermant-agent-x.x.x/agent/config/config.properties</code>找到该配置文件，修改的配置项如下所示：</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>agent.service.heartbeat.enable=true <span class="token comment"># 心跳服务开关</span>
agent.service.gateway.enable=true   <span class="token comment"># 统一网关服务开关</span>
notification.enable=true            <span class="token comment"># 内部事件通知开关</span>
</code></pre></div><ul><li>修改服务可见性插件配置
在<code>${path}/sermant-agent-x.x.x/agent/pluginPackage/service-visibility/config/config.yaml</code>找到该插件的配置文件， 修改的配置项如下所示：</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">visibility.config</span><span class="token punctuation">:</span>
  <span class="token key atrule">startFlag</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token comment"># 服务可见性采集开关。为true时进行数据采集上报。</span>
</code></pre></div><h3 id="_4-启动应用"><a href="#_4-启动应用" class="header-anchor">#</a> 4 启动应用</h3> <ul><li>参考如下命令, 启动backend应用。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Linux</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> <span class="token variable">${path}</span>/sermant-agent-x.x.x/server/sermant/sermant-backend-x.x.x.jar
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Windows</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> <span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>server<span class="token punctuation">\</span>sermant<span class="token punctuation">\</span>sermant-backend-x.x.x.jar
</code></pre></div><ul><li>参考如下命令, 启动dubbo-2-6-integration-consumer应用。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Linux</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>consumer <span class="token parameter variable">-jar</span>  dubbo-integration-consumer.jar
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Windows</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>consumer <span class="token parameter variable">-jar</span>  dubbo-integration-consumer.jar
</code></pre></div><ul><li>参考如下命令, 启动dubbo-2-6-integration-provider应用。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Linux</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>provider <span class="token parameter variable">-jar</span> dubbo-integration-provider.jar
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Windows</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>provider <span class="token parameter variable">-jar</span> dubbo-integration-provider.jar
</code></pre></div><blockquote><p><strong>说明：</strong> ${path}为sermant实际安装路径，x.x.x代表sermant某个版本号。</p></blockquote> <h3 id="_5-验证"><a href="#_5-验证" class="header-anchor">#</a> 5 验证</h3> <p>访问可见性信息查询接口<code>http://127.0.0.1:8900/visibility/getCollectorInfo</code>可以看到采集的信息，则说明插件生效。</p> <p>服务可见性信息的数据结构如下所示：</p> <ul><li>契约信息的数据结构：</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
 <span class="token property">&quot;contractList &quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token property">&quot;serviceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dubbo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;interfaceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.sermant.integration.service.BarService&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;serviceKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.sermant.integration.service.BarService&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.sermant.integration.service.BarService&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;methodInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
   <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;paramInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;paramType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;paramName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;str&quot;</span>
   <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token property">&quot;returnInfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;paramType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>依赖关系信息的数据结构：</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
 <span class="token property">&quot;consanguinityList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token property">&quot;serviceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dubbo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;interfaceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.sermant.integration.service.BarService&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.sermant.integration.service.BarService&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;serviceKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.sermant.integration.service.BarService&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;providers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
   <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x.x.x.x&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token string">&quot;28821&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;serviceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dubbo&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;serviceKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.sermant.integration.service.BarService&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;io.sermant.integration.service.BarService&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/8/30 02:34:51</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/document/plugin/monitor.html" class="prev">
        监控
      </a></span> <span class="next"><a href="/zh/document/plugin/mq-consume-prohibition.html">
        消息队列禁止消费
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.66cb36cf.js" defer></script><script src="/assets/js/3.06f127bc.js" defer></script><script src="/assets/js/1.c8bacf5b.js" defer></script><script src="/assets/js/106.b52c0d7f.js" defer></script>
  </body>
</html>
