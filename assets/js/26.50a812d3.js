(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{470:function(a,e,t){"use strict";t.r(e);var s=t(26),n=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"bytecode-enhancement"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bytecode-enhancement"}},[a._v("#")]),a._v(" Bytecode Enhancement")]),a._v(" "),e("p",[a._v("In each "),e("code",[a._v("plugin main module")]),a._v(" of  "),e("strong",[a._v("Sermant")]),a._v(" plugin, some enhancement logic can be declared to enhance bytecode for certain methods of the host application in order to achieve a certain function, so it is an important topic to describe what class and class methods to enhance.")]),a._v(" "),e("h2",{attrs:{id:"enhanced-statement"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#enhanced-statement"}},[a._v("#")]),a._v(" Enhanced Statement")]),a._v(" "),e("p",[a._v("In plugin development, the bytecode enhancement declaration needs to be defined in the "),e("RouterLink",{attrs:{to:"/en/document/developer-guide/package-structure.html#Plugin-Main-Module"}},[a._v("main module of the plugin")]),a._v(", declaring the plugin bytecode enhancement logic requires implementing "),e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/PluginDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("PluginDeclarer"),e("OutboundLink")],1),a._v(" interface, which consists of three interface methods:")],1),a._v(" "),e("ul",[e("li",[e("code",[a._v("getClassMatcher")]),a._v(" method is used to get the "),e("a",{attrs:{href:"#Class-Matcher"}},[a._v("ClassMatcher")]),a._v(" of the enhanced class .")]),a._v(" "),e("li",[e("code",[a._v("getInterceptDeclarers")]),a._v(" method is used to get the "),e("a",{attrs:{href:"#Method-Matcher"}},[a._v("MethodMatcher")]),a._v(" of the intercepting method of the enhanced class, and the "),e("a",{attrs:{href:"#Interceptor"}},[a._v("Interceptor")]),a._v(" declared for the interception point, they are encapsulated in intercept statements "),e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/InterceptDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("InterceptDeclarer"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("li",[e("code",[a._v("getSuperTpeDecarers")]),a._v(" is used to get super class declaration "),e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/SuperTypeDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("SuperTypeDeclarer"),e("OutboundLink")],1),a._v(" of plugin.")])]),a._v(" "),e("p",[a._v("After the implementation is complete, you need to add the SPI profile of the PluginDeclarer interface:")]),a._v(" "),e("ul",[e("li",[a._v("Add "),e("code",[a._v("META-INF/services")]),a._v(" file in "),e("code",[a._v("resources")]),a._v(" directory.")]),a._v(" "),e("li",[a._v("Add "),e("code",[a._v("com.huaweicloud.sermant.core.plugin.agent.declarer.PluginDeclarer")]),a._v(" profile file in "),e("code",[a._v("META-INF/services")]),a._v(".")]),a._v(" "),e("li",[a._v("In the above file, separated by exchange behavior, type the fully qualified names of all the classes in the plugin package that implement the PluginDeclarer interface.")])]),a._v(" "),e("h2",{attrs:{id:"class-matcher"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#class-matcher"}},[a._v("#")]),a._v(" Class Matcher")]),a._v(" "),e("p",[a._v("For "),e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("ClassMatcher"),e("OutboundLink")],1),a._v(", two types of matchers are provided in the core module：")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassTypeMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("ClassTypeMatcher"),e("OutboundLink")],1),a._v("(Class type matcher)")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Matching by name, which is the most common method of locating, can be obtained by the following methods:")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameEquals")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${class reference}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${class reference}")]),a._v(" is the fully qualified name of the enhanced class.")])]),a._v(" "),e("li",[e("p",[a._v("Matches multiple classes by name, belonging to the plural version of "),e("code",[a._v("nameEquals")]),a._v(", which can be obtained by the following method:")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameContains")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${class reference array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${class reference array}")]),a._v(" is a fully qualified mutable array of the enhanced class.")])])]),a._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassFuzzyMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("ClassFuzzyMatcher"),e("OutboundLink")],1),a._v("（Fuzzy matcher of class）")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("The enhanced class is located by the fully qualified name prefix, which can be obtained by the following method:")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("namePrefixedWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${prefix}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${prefix}")]),a._v(" is a fully qualified name prefix.")])]),a._v(" "),e("li",[e("p",[a._v("The fully qualified name suffix is used to locate the enhanced class, which can be obtained by the following method：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameSuffixedWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${suffix}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("p",[e("code",[a._v("${suffix}")]),a._v(" is a fully qualified name suffix.")])]),a._v(" "),e("li",[e("p",[a._v("The enhanced class is located by a fully qualified name infix, which can be obtained by the following method：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameinfixedWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${infix}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("p",[e("code",[a._v("${infix}")]),a._v(" is a fully qualified name infix.")])]),a._v(" "),e("li",[e("p",[a._v("Locate the enhanced class by matching the fully qualified name with a regular expression, which can be obtained by the following methods:")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameMatches")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${pattern}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("p",[e("code",[a._v("${pattern}")]),a._v(" is a regular expression.")])]),a._v(" "),e("li",[e("p",[a._v("The annotation is used to locate the class that is modified by the annotation, which can be obtained by:")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("isAnnotationWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${annotation reference array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${annotation reference array}")]),a._v(" a fully qualified mutable array for annotations.")])]),a._v(" "),e("li",[e("p",[a._v("The superclass locates the subclass of the class, which can be obtained by the following method：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("isExtendedFrom")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${super class array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${super class array}")]),a._v(" is a superclass variable array. Due to Java's inheritance rules, this array can only have one "),e("code",[a._v("Class")]),a._v(" and the rest must be all "),e("code",[a._v("interfaces")]),a._v(".")])]),a._v(" "),e("li",[e("p",[a._v("A logical operation that matches is true if none of the matchers match：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("not")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${class matcher array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("p",[e("code",[a._v("${class matcher array}")]),a._v(" is a variable length array for matchers.")])]),a._v(" "),e("li",[e("p",[a._v("A logical operation that matches is true when all matchers match：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("and")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${class matcher array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("p",[e("code",[a._v("${class matcher array}")]),a._v(" is a variable length array for matchers.")])]),a._v(" "),e("li",[e("p",[a._v("The logical operation of matching, where one of the matchers matches is true：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("or")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${class matcher array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("p",[e("code",[a._v("${class matcher array}")]),a._v(" is a variable length array for matchers.")])])]),a._v(" "),e("h2",{attrs:{id:"method-matcher"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#method-matcher"}},[a._v("#")]),a._v(" Method Matcher")]),a._v(" "),e("p",[a._v("For "),e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/MethodMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("MethodMatcher"),e("OutboundLink")],1),a._v(", a variety of matching methods are provided:")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Full matching：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("any")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Name matching：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameEquals")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${method name}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${method name}")]),a._v(" is method name。")])]),a._v(" "),e("li",[e("p",[a._v("Matching static method：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("isStaticMethod")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Matching constructor：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("isConstructor")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("Matching multiple methods：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameContains")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${method name array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${method name array}")]),a._v(" is an array of method names.")])]),a._v(" "),e("li",[e("p",[a._v("Match by method name prefix：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("namePrefixedWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${method name prefix}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${method name prefix}")]),a._v(" is a method name prefix.")])]),a._v(" "),e("li",[e("p",[a._v("Match by method name suffix：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameSuffixedWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${method name suffix}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${method name suffix}")]),a._v(" is a method name suffix.")])]),a._v(" "),e("li",[e("p",[a._v("Match by method name infix：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameinfixedWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${method name infix}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${method name infix}")]),a._v(" is a method name infix.")])]),a._v(" "),e("li",[e("p",[a._v("Match according to regular expression：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("nameMatches")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${pattern}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${pattern}")]),a._v(" is regular expression.")])]),a._v(" "),e("li",[e("p",[a._v("Matches the method modified by the incoming annotation：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("isAnnotatedWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${annotations array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${annotations array}")]),a._v(" is annotation set.")])]),a._v(" "),e("li",[e("p",[a._v("Matches the method with the specified number of inputs：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("paramCountEquals")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${param count}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${param count}")]),a._v(" is  the specified number of inputs.")])]),a._v(" "),e("li",[e("p",[a._v("Matches the method of the specified input type：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("paramTypeEquals")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${param type array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${param type array}")]),a._v(" is an input type set.")])]),a._v(" "),e("li",[e("p",[a._v("Matches a method of the specified return value type：")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("resultTypeEquals")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${result type}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${result type}")]),a._v(" is return value type.")])]),a._v(" "),e("li",[e("p",[a._v("Logical operation, the result is true if the method matcher set does not match at all:")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("not")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${element matcher array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${element matcher array}")]),a._v(" is method matcher set.")])]),a._v(" "),e("li",[e("p",[a._v("Logical operation, the result is true if the method matcher set matches all:")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("and")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${element matcher array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${element matcher array}")]),a._v(" is method matcher set.")])]),a._v(" "),e("li",[e("p",[a._v("Logical operation where the result is true if one of the method matchers in the set matches:")]),a._v(" "),e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodMatcher")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("or")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${element matcher array}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),e("p",[e("code",[a._v("${element matcher array}")]),a._v(" is method matcher set.")])])]),a._v(" "),e("p",[a._v("For more method matching methods, see the method with the "),e("code",[a._v("MethodDescription")]),a._v(" generic in "),e("a",{attrs:{href:"https://javadoc.io/doc/net.bytebuddy/byte-buddy/latest/net/bytebuddy/matcher/ElementMatchers.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("byte-buddy"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("h3",{attrs:{id:"native-class-enhancement"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#native-class-enhancement"}},[a._v("#")]),a._v(" Native Class Enhancement")]),a._v(" "),e("p",[a._v("There is no difference between enhancing native classes and enhancing ordinary classes in terms of enhancement definition and interceptor writing, but it is desirable for plugin developers to enhance native classes as little as possible for three reasons:")]),a._v(" "),e("ul",[e("li",[a._v("Enhancements to native classes tend to be diffused, and enhancements to them are likely to have an impact on other plugins or host functions.")]),a._v(" "),e("li",[a._v("Enhanced logic for native classes invokes the interceptor methods in the system class loader using reflection. Due to the limitations of "),e("em",[a._v("Java")]),a._v(" redefinition "),e("em",[a._v("Class")]),a._v(", every time the enhanced method is called, the reflection processing logic will be performed, which will greatly affect the performance of the enhanced method.")]),a._v(" "),e("li",[a._v("Enhancements to native classes involve generating dynamic intercepting classes using "),e("strong",[a._v("Advice template classes")]),a._v(". For each enhanced native class method, one is generated dynamically, and they are loaded by the system class loader. If native classes are enhanced without restriction, loading dynamic classes can also become a considerable burden during the startup process.")])]),a._v(" "),e("p",[a._v("To sum up, The ability to enhance "),e("em",[a._v("Java")]),a._v(" native classes is provided in "),e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[a._v("Sermant")]),a._v(" core function module"),e("OutboundLink")],1),a._v(", but it is not recommended to enhance them without restriction, if there are multiple enhancement points to choose from, the common class is preferred.")]),a._v(" "),e("h2",{attrs:{id:"interceptor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#interceptor"}},[a._v("#")]),a._v(" Interceptor")]),a._v(" "),e("p",[a._v("Interceptors are used to define enhancement logic when bytecode enhancement is performed on methods of the enhanced class, when postset, and when exception handling is performed：")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-god/src/main/java/com/huaweicloud/sermant/core/plugin/agent/interceptor/Interceptor.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("Interceptor"),e("OutboundLink")],1),a._v(": interceptor interface, which contains three methods：\n"),e("ul",[e("li",[e("code",[a._v("before")]),a._v(": prefix method, which is executed before the intercept point. The ExecuteContext argument is the context in which the plugin executes, encapsulating all the parameters needed for the interceptor to operate. The skip method allows you to skip the main flow and set the final method result. Note that the main flow cannot be skipped when the constructor is enhanced.")]),a._v(" "),e("li",[e("code",[a._v("after")]),a._v(":  post method, regardless of whether the blocked method is executed normally, will eventually enter the post-method. Post methods can override the return value of the intercepted method with a return value, so developers need to be careful not to return null too easily here.")]),a._v(" "),e("li",[e("code",[a._v("onThrow")]),a._v(": a method to handle exceptions, triggered when the intercepted method executes an exception. Handling the exception here does not affect the normal throwing of the exception.")])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);