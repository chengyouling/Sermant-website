(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{538:function(t,a,e){"use strict";e.r(a);var s=e(26),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"离群实例摘除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#离群实例摘除"}},[t._v("#")]),t._v(" 离群实例摘除")]),t._v(" "),a("p",[t._v("本文介绍如何使用"),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-plugins/sermant-service-removal",target:"_blank",rel:"noopener noreferrer"}},[t._v("离群实例摘除插件"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"功能介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能介绍"}},[t._v("#")]),t._v(" 功能介绍")]),t._v(" "),a("p",[t._v("离群实例摘除插件通过无侵入的方式检测应用实例的可用性，并对异常的应用实例进行摘除操作，以保证服务的稳定性。离群实例摘除插件会在一段时间过后重新检测被摘除实例的可用性，若实例恢复正常则取消对其的摘除操作。")]),t._v(" "),a("h2",{attrs:{id:"参数配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数配置"}},[t._v("#")]),t._v(" 参数配置")]),t._v(" "),a("h3",{attrs:{id:"插件配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件配置"}},[t._v("#")]),t._v(" 插件配置")]),t._v(" "),a("p",[t._v("离群实例摘除插件需要配置离群实例摘除插件开关（"),a("code",[t._v("removal.config.enableRemoval")]),t._v("）、实例调用信息过期时间（"),a("code",[t._v("removal.config.expireTime")]),t._v("）、插件支持的服务调用异常情况（"),a("code",[t._v("removal.config..exceptions")]),t._v("）、实例摘除后的恢复时间（"),a("code",[t._v("removal.config.recoveryTime")]),t._v("）和离群实例摘除规则（"),a("code",[t._v("removal.config.rules")]),t._v("）,可在"),a("code",[t._v("${path}/sermant-agent-x.x.x/agent/pluginPackage/service-removal/config/config.yaml")]),t._v("找到该插件的配置文件， 配置如下所示：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 离群实例摘除插件配置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("removal.config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expireTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例调用信息过期时间。单位：毫秒")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exceptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 插件支持的服务调用异常情况")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" com.alibaba.dubbo.remoting.TimeoutException\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" org.apache.dubbo.remoting.TimeoutException\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" java.util.concurrent.TimeoutException\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" java.net.SocketTimeoutException\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableRemoval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 离群实例摘除开关")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recoveryTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例摘除之后的恢复时间")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 离群实例摘除规则，key：服务名称（为default-rule时针对所有服务都生效），scaleUpLimit：离群实例摘除比例上限。minInstanceNum：最小实例数。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scaleUpLimit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minInstanceNum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("errorRate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("参数键")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("默认值")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("是否必须")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("removal.config.expireTime")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("实例调用信息过期时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("60000")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("removal.config.exceptions")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("插件支持的服务调用异常情况")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("com.alibaba.dubbo.remoting.TimeoutException "),a("br"),t._v("org.apache.dubbo.remoting.TimeoutException "),a("br"),t._v("java.util.concurrent.TimeoutException "),a("br"),t._v("java.net.SocketTimeoutException")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("removal.config.enableRemoval")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("实例摘除插件的开关")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("false")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("removal.config.recoveryTime")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("实例摘除之后的恢复时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("30000")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("removal.config.rules")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("离群实例摘除规则："),a("br"),t._v("key：服务名称（为default-rule时针对所有服务都生效）"),a("br"),t._v("scaleUpLimit：离群实例摘除比例上限 "),a("br"),t._v("minInstanceNum：最小实例数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("{ key: default-rule, scaleUpLimit: 0.6, minInstanceNum: 1, errorRate: 0.6 }")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是")])])])]),t._v(" "),a("h2",{attrs:{id:"详细摘除规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#详细摘除规则"}},[t._v("#")]),t._v(" 详细摘除规则")]),t._v(" "),a("p",[t._v("离群实例摘除插件也支持基于动态配置中心进行配置发布，配置发布可以参考"),a("RouterLink",{attrs:{to:"/zh/document/user-guide/configuration-center.html#发布配置"}},[t._v("动态配置中心使用手册")]),t._v("。")],1),t._v(" "),a("p",[t._v("其中key值为"),a("strong",[t._v("sermant.removal.config")]),t._v("。group值为"),a("strong",[t._v("app=${service.meta.application}&environment=${service.meta.environment}")]),t._v("，即应用配置。service.meta.application、service.meta.environment的配置请参考"),a("RouterLink",{attrs:{to:"/zh/document/user-guide/sermant-agent.html#sermant-agent使用参数配置"}},[t._v("Sermant-agent使用手册")]),t._v("。")],1),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("说明：")]),t._v(" 应用配置说明参考"),a("a",{attrs:{href:"https://support.huaweicloud.com/devg-cse/cse_devg_0020.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSE配置中心概述"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[t._v("content值为具体的离群实例摘除规则配置。配置内容如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expireTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例调用信息过期时间。单位：毫秒")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exceptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 插件支持的服务调用异常情况")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" com.alibaba.dubbo.remoting.TimeoutException\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" org.apache.dubbo.remoting.TimeoutException\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" java.util.concurrent.TimeoutException\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" java.net.SocketTimeoutException\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableRemoval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 离群实例摘除开关")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recoveryTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例摘除之后的恢复时间")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 离群实例摘除规则，key：服务名称（为default-rule时针对所有服务都生效），scaleUpLimit：离群实例摘除比例上限。minInstanceNum：最小实例数。")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scaleUpLimit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minInstanceNum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("errorRate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("注意：")]),t._v(" 新增配置时，请去掉注释，否则会导致新增失败。")])]),t._v(" "),a("h2",{attrs:{id:"支持版本与限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持版本与限制"}},[t._v("#")]),t._v(" 支持版本与限制")]),t._v(" "),a("p",[t._v("框架支持：")]),t._v(" "),a("ul",[a("li",[t._v("SpringBoot 1.5.10.Release及以上")]),t._v(" "),a("li",[t._v("Dubbo 2.6.x-2.7.x")])]),t._v(" "),a("h2",{attrs:{id:"操作和结果验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作和结果验证"}},[t._v("#")]),t._v(" 操作和结果验证")]),t._v(" "),a("p",[t._v("下面将演示如何使用离群实例摘除插件，验证采用ZooKeeper配置中心为SpringCloud应用配置离群摘除规则场景。")]),t._v(" "),a("h3",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/releases/download/v1.3.0/sermant-examples-removal-demo-1.3.0.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v(" Demo二进制产物压缩包")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/releases/download/v1.3.0/sermant-1.3.0.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v(" Sermant\nRelease包（当前版本推荐1.3.0版本）")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zookeeper.apache.org/releases#download",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v(" 并启动ZooKeeper")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("注意：")]),t._v(" "),a("RouterLink",{attrs:{to:"/zh/document/user-guide/configuration-center.html"}},[t._v("动态配置中心")]),t._v("会在本场景中默认使用，由于非本场景的核心组件，因此在本文中不额外赘述。")],1)]),t._v(" "),a("h3",{attrs:{id:"步骤一-获取demo二进制产物"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤一-获取demo二进制产物"}},[t._v("#")]),t._v(" 步骤一：获取Demo二进制产物")]),t._v(" "),a("p",[t._v("解压Demo二进制产物压缩包，即可得到"),a("code",[t._v("rest-consumer.jar")]),t._v("和"),a("code",[t._v("rest-provider.jar")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"步骤二-修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤二-修改配置"}},[t._v("#")]),t._v(" 步骤二：修改配置")]),t._v(" "),a("ul",[a("li",[t._v("修改离群摘除插件配置，可在"),a("code",[t._v("${path}/sermant-agent-x.x.x/agent/pluginPackage/service-removal/config/config.yaml")]),t._v("找到该配置文件。")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("removal.config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expireTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例调用信息过期时间。单位：毫秒")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exceptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 插件支持的服务调用异常情况")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" com.alibaba.dubbo.remoting.TimeoutException\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" org.apache.dubbo.remoting.TimeoutException\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" java.util.concurrent.TimeoutException\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" java.net.SocketTimeoutException\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableRemoval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 离群实例摘除开关")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recoveryTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例摘除之后的恢复时间")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 离群实例摘除规则，key：服务名称（为default-rule时针对所有服务都生效），scaleUpLimit：离群实例摘除比例上限。minInstanceNum：最小实例数。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scaleUpLimit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minInstanceNum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("errorRate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"步骤三-启动应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤三-启动应用"}},[t._v("#")]),t._v(" 步骤三：启动应用")]),t._v(" "),a("ul",[a("li",[t._v("参考如下命令启动Demo应用")])]),t._v(" "),a("p",[t._v("（1）启动消费者")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Linux")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),t._v("/sermant-agent-x.x.x/agent/sermant-agent.jar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("appName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dniws.loadbalancer.availabilityFilteringRule.filterCircuitTripped")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" rest-consumer.jar\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Windows")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent-x.x.x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent.jar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("appName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dniws.loadbalancer.availabilityFilteringRule.filterCircuitTripped")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" rest-consumer.jar\n")])])]),a("p",[t._v("（2）启动生产者")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# windows,Linux,mac")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" rest-provider.jar\n")])])]),a("p",[t._v("（3）启动第二个生产者")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# windows,Linux,mac")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dtimeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dserver.port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8006")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" rest-provider.jar\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("注意：")]),t._v(" ${path}为sermant实际安装路径，x.x.x代表sermant某个版本号。")])]),t._v(" "),a("h3",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),a("p",[t._v("通过浏览器一直访问"),a("code",[t._v("http://localhost:8005/hello")]),t._v("，刚开始会出现服务请求成功和请求异常两种情况。30秒后异常实例会被摘除，摘除后会一直请求成功。30秒后摘除的异常实例会恢复，会重新出现请求异常。")]),t._v(" "),a("p",[t._v("查询效果图如下所示：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("请求成功效果图\n"),a("MyImage",{attrs:{src:"/docs-img/removal-req-success.png"}})],1)]),t._v(" "),a("li",[a("p",[t._v("请求失败效果图\n"),a("MyImage",{attrs:{src:"/docs-img/removal-req-fail.png"}})],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);