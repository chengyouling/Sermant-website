<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Proxyless Service Mesh Based on Sermant and Istio | Sermant</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.svg">
    <meta name="description" content="A Proxyless Service Mesh based on Bytecode Enhancement">
    
    <link rel="preload" href="/assets/css/0.styles.aea4a1e9.css" as="style"><link rel="preload" href="/assets/js/app.5c3a2ada.js" as="script"><link rel="preload" href="/assets/js/3.06f127bc.js" as="script"><link rel="preload" href="/assets/js/1.c8bacf5b.js" as="script"><link rel="preload" href="/assets/js/65.872254de.js" as="script"><link rel="preload" href="/assets/js/14.199c38f6.js" as="script"><link rel="prefetch" href="/assets/js/10.3c86f8c0.js"><link rel="prefetch" href="/assets/js/100.bc317380.js"><link rel="prefetch" href="/assets/js/101.9eaa8bdf.js"><link rel="prefetch" href="/assets/js/102.21b419e1.js"><link rel="prefetch" href="/assets/js/103.8442a309.js"><link rel="prefetch" href="/assets/js/104.ab4d19d9.js"><link rel="prefetch" href="/assets/js/105.2d9ea0d0.js"><link rel="prefetch" href="/assets/js/106.628c4010.js"><link rel="prefetch" href="/assets/js/107.00c8fef4.js"><link rel="prefetch" href="/assets/js/108.a360032a.js"><link rel="prefetch" href="/assets/js/109.b929d20b.js"><link rel="prefetch" href="/assets/js/11.592204d9.js"><link rel="prefetch" href="/assets/js/110.155bc202.js"><link rel="prefetch" href="/assets/js/111.611a7295.js"><link rel="prefetch" href="/assets/js/112.66fbc4db.js"><link rel="prefetch" href="/assets/js/113.d848a339.js"><link rel="prefetch" href="/assets/js/114.490e1858.js"><link rel="prefetch" href="/assets/js/115.e546b6ae.js"><link rel="prefetch" href="/assets/js/116.92640e89.js"><link rel="prefetch" href="/assets/js/117.8200e73f.js"><link rel="prefetch" href="/assets/js/12.fd6a031f.js"><link rel="prefetch" href="/assets/js/13.5f38272f.js"><link rel="prefetch" href="/assets/js/15.900a8374.js"><link rel="prefetch" href="/assets/js/16.dc00a508.js"><link rel="prefetch" href="/assets/js/17.7bb9b1f6.js"><link rel="prefetch" href="/assets/js/18.0cb1c621.js"><link rel="prefetch" href="/assets/js/19.f3f80c20.js"><link rel="prefetch" href="/assets/js/20.341a6ad9.js"><link rel="prefetch" href="/assets/js/21.f3cbb9a3.js"><link rel="prefetch" href="/assets/js/22.9fae982b.js"><link rel="prefetch" href="/assets/js/23.80aecc10.js"><link rel="prefetch" href="/assets/js/24.96ad3256.js"><link rel="prefetch" href="/assets/js/25.ece41e63.js"><link rel="prefetch" href="/assets/js/26.fe2d3037.js"><link rel="prefetch" href="/assets/js/27.09e84572.js"><link rel="prefetch" href="/assets/js/28.b0950095.js"><link rel="prefetch" href="/assets/js/29.e99b36c0.js"><link rel="prefetch" href="/assets/js/30.438dae02.js"><link rel="prefetch" href="/assets/js/31.3c3370de.js"><link rel="prefetch" href="/assets/js/32.1e0d9710.js"><link rel="prefetch" href="/assets/js/33.c2b0d053.js"><link rel="prefetch" href="/assets/js/34.e19240ac.js"><link rel="prefetch" href="/assets/js/35.284e0503.js"><link rel="prefetch" href="/assets/js/36.572ec5d2.js"><link rel="prefetch" href="/assets/js/37.67ca14dd.js"><link rel="prefetch" href="/assets/js/38.cc1aa285.js"><link rel="prefetch" href="/assets/js/39.ba21af57.js"><link rel="prefetch" href="/assets/js/4.7add7152.js"><link rel="prefetch" href="/assets/js/40.bb68876d.js"><link rel="prefetch" href="/assets/js/41.5aad2ff2.js"><link rel="prefetch" href="/assets/js/42.4c8a6e50.js"><link rel="prefetch" href="/assets/js/43.71503fb0.js"><link rel="prefetch" href="/assets/js/44.edc75f88.js"><link rel="prefetch" href="/assets/js/45.18155682.js"><link rel="prefetch" href="/assets/js/46.0924b4b7.js"><link rel="prefetch" href="/assets/js/47.a56e6420.js"><link rel="prefetch" href="/assets/js/48.c14baed2.js"><link rel="prefetch" href="/assets/js/49.01c94e37.js"><link rel="prefetch" href="/assets/js/5.4a333fb7.js"><link rel="prefetch" href="/assets/js/50.620a948f.js"><link rel="prefetch" href="/assets/js/51.dcd595e3.js"><link rel="prefetch" href="/assets/js/52.2da2539a.js"><link rel="prefetch" href="/assets/js/53.0d9a34be.js"><link rel="prefetch" href="/assets/js/54.3fbc8a94.js"><link rel="prefetch" href="/assets/js/55.8756d3f5.js"><link rel="prefetch" href="/assets/js/56.72d98c9b.js"><link rel="prefetch" href="/assets/js/57.da44ebe0.js"><link rel="prefetch" href="/assets/js/58.13279f74.js"><link rel="prefetch" href="/assets/js/59.50ea3b1d.js"><link rel="prefetch" href="/assets/js/6.72029eac.js"><link rel="prefetch" href="/assets/js/60.1c849715.js"><link rel="prefetch" href="/assets/js/61.7cb6ab5f.js"><link rel="prefetch" href="/assets/js/62.fffe3261.js"><link rel="prefetch" href="/assets/js/63.17565528.js"><link rel="prefetch" href="/assets/js/64.549ab63a.js"><link rel="prefetch" href="/assets/js/66.b950e256.js"><link rel="prefetch" href="/assets/js/67.1d117980.js"><link rel="prefetch" href="/assets/js/68.ab61ad07.js"><link rel="prefetch" href="/assets/js/69.cb31f10a.js"><link rel="prefetch" href="/assets/js/7.698dd478.js"><link rel="prefetch" href="/assets/js/70.fa24862f.js"><link rel="prefetch" href="/assets/js/71.c54f213a.js"><link rel="prefetch" href="/assets/js/72.9599f4a0.js"><link rel="prefetch" href="/assets/js/73.e0471b8c.js"><link rel="prefetch" href="/assets/js/74.c514e0f0.js"><link rel="prefetch" href="/assets/js/75.38eba665.js"><link rel="prefetch" href="/assets/js/76.9a698c78.js"><link rel="prefetch" href="/assets/js/77.c638970a.js"><link rel="prefetch" href="/assets/js/78.766969e2.js"><link rel="prefetch" href="/assets/js/79.b230fe9f.js"><link rel="prefetch" href="/assets/js/8.10750ce9.js"><link rel="prefetch" href="/assets/js/80.bf63f769.js"><link rel="prefetch" href="/assets/js/81.d1fccca7.js"><link rel="prefetch" href="/assets/js/82.25316f1c.js"><link rel="prefetch" href="/assets/js/83.34799413.js"><link rel="prefetch" href="/assets/js/84.9b63b88a.js"><link rel="prefetch" href="/assets/js/85.fb56f22c.js"><link rel="prefetch" href="/assets/js/86.76c9ee38.js"><link rel="prefetch" href="/assets/js/87.1b015939.js"><link rel="prefetch" href="/assets/js/88.91bc0db4.js"><link rel="prefetch" href="/assets/js/89.ef4b9c6d.js"><link rel="prefetch" href="/assets/js/9.7f57e4b0.js"><link rel="prefetch" href="/assets/js/90.f7fd1688.js"><link rel="prefetch" href="/assets/js/91.4b55a138.js"><link rel="prefetch" href="/assets/js/92.571bab7d.js"><link rel="prefetch" href="/assets/js/93.86854ac1.js"><link rel="prefetch" href="/assets/js/94.2092419b.js"><link rel="prefetch" href="/assets/js/95.a45c6b10.js"><link rel="prefetch" href="/assets/js/96.9ff15576.js"><link rel="prefetch" href="/assets/js/97.433fa015.js"><link rel="prefetch" href="/assets/js/98.cc6d3aae.js"><link rel="prefetch" href="/assets/js/99.3103e64b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aea4a1e9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/img/sermant-logo.png" alt="Sermant" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/user-guide/sermant-xds.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/user-guide/sermant-xds.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/user-guide/sermant-xds.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/user-guide/sermant-xds.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>User Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/document/user-guide/" aria-current="page" class="sidebar-link">Introduction to the use of Sermant</a></li><li><a href="/en/document/user-guide/sermant-agent.html" class="sidebar-link">Sermant Agent User Manual</a></li><li><a href="/en/document/user-guide/sermant-backend.html" class="sidebar-link">Sermant Backend User Manual</a></li><li><a href="/en/document/user-guide/configuration-center.html" class="sidebar-link">Dynamic Configuration Center User Manual</a></li><li><a href="/en/document/user-guide/sermant-xds.html" aria-current="page" class="active sidebar-link">Proxyless Service Mesh Based on Sermant and Istio</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/document/user-guide/sermant-xds.html#service-governance-of-sermant-in-istio-environment" class="sidebar-link">Service Governance of Sermant in Istio Environment</a></li><li class="sidebar-sub-header"><a href="/en/document/user-guide/sermant-xds.html#service-discovery-based-on-xds-service" class="sidebar-link">Service Discovery based on xDS Service</a></li><li class="sidebar-sub-header"><a href="/en/document/user-guide/sermant-xds.html#routing-based-on-xds-service" class="sidebar-link">Routing based on xDS Service</a></li><li class="sidebar-sub-header"><a href="/en/document/user-guide/sermant-xds.html#load-balancing-based-on-xds-service" class="sidebar-link">Load Balancing based on xDS Service</a></li><li class="sidebar-sub-header"><a href="/en/document/user-guide/sermant-xds.html#startup-and-result-verification" class="sidebar-link">Startup and Result Verification</a></li></ul></li><li><a href="/en/document/user-guide/injector.html" class="sidebar-link">Sermant Injector User Manual</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Plugin Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developer Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Community Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="proxyless-service-mesh-based-on-sermant-and-istio"><a href="#proxyless-service-mesh-based-on-sermant-and-istio" class="header-anchor">#</a> Proxyless Service Mesh Based on Sermant and Istio</h1> <h2 id="service-governance-of-sermant-in-istio-environment"><a href="#service-governance-of-sermant-in-istio-environment" class="header-anchor">#</a> Service Governance of Sermant in Istio Environment</h2> <p>A service mesh is an infrastructure layer that handles service-to-service communication. It reliably delivers requests through the complex service topology that constitutes modern cloud-native applications. In practice, service mesh is usually implemented as a lightweight array of network proxies, which are deployed alongside application code, without the application being aware of the presence of these proxies.</p> <p>Istio is currently the most widely used Service Mesh product, consisting of a control plane and a data plane. The data plane in Istio typically deploys separate sidecar containers to proxy microservices, resulting in additional performance overhead, including increased CPU usage and significant growth in service call latency. Additionally, this setup increases system complexity and the difficulty of operations and maintenance.</p> <p>The Sermant xDS service allows microservices to integrate with Istio in a Kubernetes environment. Sermant communicates directly with Istio's control plane based on the xDS protocol to obtain configuration information such as service discovery and routing, thereby replacing Envoy as Istio's data plane for service governance.</p> <p>Sermant is a cloud-native, proxyless service mesh based on a Java Agent. Microservices run Sermant in the same process, eliminating the need to start additional sidecar containers for network proxying. This significantly reduces application performance overhead and call latency between services.</p> <h3 id="istio-sermant-sidecar-proxyless-mode-deployment"><a href="#istio-sermant-sidecar-proxyless-mode-deployment" class="header-anchor">#</a> Istio+Sermant Sidecar Proxyless Mode Deployment</h3> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <ol><li>Mixed Deployment Mode: Coexistence of Sidecar Proxy Mode and Sidecar Proxyless Mode. Microservices connect to Istio and achieve service governance through a mixed deployment mode. This mode avoids modifying the existing deployment architecture, allowing only new services to use the Sidecar Proxyless Mode.</li> <li>Proxyless Deployment Mode: All microservices use Sermant as Istio's data plane to achieve capabilities such as service discovery、routing and load balancing. Sermant can replace the capabilities provided by Envoy, currently supporting service discovery, with more features to be developed in the future.</li></ol> <h3 id="advantages-of-using-sermant-in-istio-environment"><a href="#advantages-of-using-sermant-in-istio-environment" class="header-anchor">#</a> Advantages of using Sermant in Istio Environment</h3> <ol><li>Sermant runs in the same process as microservices, eliminating the need to start additional sidecar containers, significantly reducing network call latency and CPU overhead.</li> <li>Developing plugins based on the Sermant framework can achieve richer governance capabilities than Envoy, offering greater extensibility.</li> <li>Lower architectural complexity leads to reduced deployment costs.</li></ol> <h2 id="service-discovery-based-on-xds-service"><a href="#service-discovery-based-on-xds-service" class="header-anchor">#</a> Service Discovery based on xDS Service</h2> <p>In a Kubernetes environment, users can create Pods and Services through custom resource files using <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">Deployment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreferrer">Service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The Sermant framework implements service discovery capabilities based on the xDS protocol. Plugins can call the xDS service discovery interface to obtain instances of Kubernetes Service . For detailed development guidance, please refer to <a href="/en/document/developer-guide/sermant-xds-service.html#service-discovery-based-on-xds-protocol">Service Discovery Development Guide Based on xDS Services</a>.</p> <h3 id="template-for-creating-pod-and-service-in-kubernetes"><a href="#template-for-creating-pod-and-service-in-kubernetes" class="header-anchor">#</a> Template for Creating Pod and Service in Kubernetes</h3> <p><strong>Deployment</strong>:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: spring-test
  labels:
    app: spring-test
spec:
  replicas: 1
  selector:
    matchLabels:
      app: spring-test
  template:
    metadata:
      labels:
        app: spring-test
    spec:
      containers:
      - name: spring-test
        image: spring-test:1.0.0
        ports:
        - containerPort: 8003
</code></pre></div><p><strong>Service</strong>:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Service
metadata:
  name: spring-test
spec:
  type: ClusterIP
  ports:
  - name: test
    port: 8003
    targetPort: 8003
    protocol: TCP
  selector:
    app: spring-test
</code></pre></div><blockquote><p>Note: Sermant uses the <code>metadata.name</code> of the Service resource file as the service name for service discovery.</p></blockquote> <h3 id="sermant-plugins-supportting-xds-service-discovery"><a href="#sermant-plugins-supportting-xds-service-discovery" class="header-anchor">#</a> Sermant Plugins Supportting xDS Service Discovery</h3> <ul><li><a href="/en/document/plugin/router.html#routing-based-on-the-xds-protocol">Router Plugin</a></li></ul> <h2 id="routing-based-on-xds-service"><a href="#routing-based-on-xds-service" class="header-anchor">#</a> Routing based on xDS Service</h2> <p>The Sermant framework implements the ability to retrieve routing configurations based on the xDS protocol. Plugins can call the xDS routing configuration service interface to obtain routing configurations for Kubernetes Services. For specific development guidance, please refer to <a href="/en/document/developer-guide/sermant-xds-service.html#route-configuration-service-based-on-xds-protocol">Development Guide for Routing Configuration Service Based on xDS</a>.</p> <h3 id="supported-istio-routing-configuration-fields"><a href="#supported-istio-routing-configuration-fields" class="header-anchor">#</a> Supported Istio Routing Configuration Fields</h3> <p>Istio delivers routing configurations via custom resource files such as DestinationRule and VirtualService. Sermant communicates with Istio's control plane via the xDS protocol to obtain routing configurations. The following are the supported routing configuration fields:</p> <p><strong>VirtualService</strong>:</p> <table><thead><tr><th>Supported Fields</th> <th>Description</th></tr></thead> <tbody><tr><td>spec.hosts</td> <td>The service domain of the route</td></tr> <tr><td>spec.hosts.http</td> <td>HTTP route configuration</td></tr> <tr><td>spec.hosts.http.match</td> <td>HTTP route matching rules</td></tr> <tr><td>spec.hosts.http.match.headers</td> <td>HTTP header matching rules, supporting exact, prefix, and regex matches</td></tr> <tr><td>spec.hosts.http.match.uri</td> <td>HTTP URI matching rules, supporting exact, prefix, and regex matches</td></tr> <tr><td>spec.hosts.http.match.ignoreUriCase</td> <td>HTTP URI case-insensitive matching</td></tr> <tr><td>spec.hosts.http.route</td> <td>HTTP route</td></tr> <tr><td>spec.hosts.http.route.destination</td> <td>HTTP route destination service</td></tr> <tr><td>spec.hosts.http.route.destination.host</td> <td>Domain name of the destination service</td></tr> <tr><td>spec.hosts.http.route.destination.subset</td> <td>Subset of the destination service</td></tr> <tr><td>spec.hosts.http.route.destination.port.number</td> <td>Port of the destination service</td></tr> <tr><td>spec.hosts.http.route.weight</td> <td>Weight of the destination service</td></tr></tbody></table> <p><strong>DestinationRule</strong>:</p> <table><thead><tr><th>Supported Fields</th> <th>Description</th></tr></thead> <tbody><tr><td>spec.trafficPolicy</td> <td>Traffic policy</td></tr> <tr><td>spec.trafficPolicy.loadBalancer</td> <td>Load balancing policy</td></tr> <tr><td>spec.trafficPolicy.loadBalancer.localityLbSetting.enabled</td> <td>Same AZ routing configuration</td></tr></tbody></table> <h3 id="istio-routing-configuration-template"><a href="#istio-routing-configuration-template" class="header-anchor">#</a> Istio Routing Configuration Template</h3> <p><strong>VirtualService</strong>:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: spring-test-virtualservice
spec:
  hosts:
  - spring-test
  http:
  - name: &quot;v1-routes&quot;
    match:
    - headers:
        version:
          exact: v1
      uri:
        exact: /test
      ignoreUriCase: false
    route:
    - destination:
        host: spring-test
        subset: v1
        port:
          number: 8003
      weight: 100
  - name: &quot;base-route&quot;
    route:
    - destination:
        host: spring-test
        subset: base
        port:
          number: 8003
</code></pre></div><blockquote><p>Description: For the upstream service with the name <code>spring-test</code>, the following routing rules apply:</p> <ol><li>HTTP requests with the <code>version:v1</code> header and the path <code>/test</code> will be routed to the <code>v1 subset</code> of <code>spring-test</code> on port 8003.</li> <li>Other HTTP requests will be routed to the <code>base subset</code> of <code>spring-test</code> on port 8003.</li></ol></blockquote> <p><strong>DestinationRule</strong>:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: spring-test-destinationrule
spec:
  host: spring-test.default.svc.cluster.local
  subsets:
  - name: v1
    labels:
      version: v1
    trafficPolicy:
      loadBalancer:
        localityLbSetting:
          enabled: true
  subsets:
  - name: base
    labels:
      version: base
    trafficPolicy:
      loadBalancer:
        localityLbSetting:
          enabled: false
</code></pre></div><blockquote><p>Description: The <code>spring-test</code> service is divided into two subsets based on the <code>version</code> label, representing two service clusters. The v1 cluster uses a same AZ routing strategy, while the base cluster does not.</p></blockquote> <p>In the future, the Sermant framework will implement routing configuration retrieval capabilities based on the xDS protocol, which will be used for service governance at the plugin layer.</p> <h3 id="sermant-plugins-supportting-xds-routing-service"><a href="#sermant-plugins-supportting-xds-routing-service" class="header-anchor">#</a> Sermant Plugins Supportting xDS Routing Service</h3> <ul><li><a href="/en/document/plugin/router.html#routing-based-on-the-xds-protocol">Router Plugin</a></li></ul> <h2 id="load-balancing-based-on-xds-service"><a href="#load-balancing-based-on-xds-service" class="header-anchor">#</a> Load Balancing based on xDS Service</h2> <p>The Sermant framework implements the ability to retrieve load balancing configurations based on the xDS protocol. Plugins can call the xDS load balancing configuration service interface to obtain load balancing configurations for Kubernetes Services. For specific development guidance, please refer to <a href="/en/document/developer-guide/sermant-xds-service.html#load-balancing-configuration-service-based-on-xds-protocol">Development Guide for Load Balancing Configuration Service Basedon xDS</a>.</p> <h3 id="supported-istio-load-balancing-configuration-fields"><a href="#supported-istio-load-balancing-configuration-fields" class="header-anchor">#</a> Supported Istio Load Balancing Configuration Fields</h3> <p>Istio delivers load balancing configurations via custom resource files such as DestinationRule. Sermant communicates with Istio's control plane using the xDS protocol to retrieve load balancing configurations. The following table lists the supported load balancing configuration fields and rules:</p> <table><thead><tr><th>Supported Fields</th> <th>Description</th></tr></thead> <tbody><tr><td>spec.trafficPolicy</td> <td>Traffic policy</td></tr> <tr><td>spec.trafficPolicy.loadBalancer</td> <td>Load balancing strategy</td></tr> <tr><td>spec.trafficPolicy.loadBalancer.simple</td> <td>Simple load balancing strategies: supports ROUND_ROBIN, RANDOM, LEAST_REQUEST</td></tr></tbody></table> <h3 id="istio-load-balancing-configuration-template"><a href="#istio-load-balancing-configuration-template" class="header-anchor">#</a> Istio Load Balancing Configuration Template</h3> <p><strong>DestinationRule</strong>:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: spring-test-destinationrule
spec:
  host: spring-test.default.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      simple: ROUND_ROBIN
  subsets:
  - name: v1
    labels:
      version: v1
    trafficPolicy:
      loadBalancer:
        simple: RANDOM
  subsets:
  - name: base
    labels:
      version: base
</code></pre></div><blockquote><p>Description: The <code>spring-test</code> service is divided into two subsets based on the <code>version</code> label, representing two service clusters. The v1 cluster uses a RANDOM load balancing strategy, while the base cluster uses a ROUND-ROBIN load balancing strategy.</p></blockquote> <h3 id="sermant-plugins-supporting-xds-load-balancing-service"><a href="#sermant-plugins-supporting-xds-load-balancing-service" class="header-anchor">#</a> Sermant Plugins Supporting xDS Load Balancing Service</h3> <ul><li><a href="/en/document/plugin/router.html#routing-based-on-the-xds-protocol">Routing Plugin</a></li></ul> <h2 id="startup-and-result-verification"><a href="#startup-and-result-verification" class="header-anchor">#</a> Startup and Result Verification</h2> <h3 id="service-discovery-example-based-on-xds-service"><a href="#service-discovery-example-based-on-xds-service" class="header-anchor">#</a> Service Discovery Example Based on xDS Service</h3> <p>This tutorial demonstrates the xDS service discovery capabilities of Sermant using the <a href="https://github.com/sermant-io/Sermant-examples/tree/main/xds-service-discovery-demo" target="_blank" rel="noopener noreferrer">Sermant-examples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> repository's xds-service-discovery-demo.</p> <p>This demo includes a spring-client microservice, a spring-server microservice, and a Sermant example plugin. The plugin intercepts the <code>hello</code> method of the spring-client and uses Sermant's xDS service discovery capabilities to get specific instance information of the spring-server service before executing the <code>hello</code> method, replacing the input parameter with the correct spring-server address.</p> <h4 id="_1-preparations"><a href="#_1-preparations" class="header-anchor">#</a> 1 Preparations</h4> <ul><li><a href="https://github.com/sermant-io/Sermant-examples/releases/download/v2.1.0/sermant-examples-xds-service-discovery-demo-2.1.0.tar.gz" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> the binary package of the demo.</li> <li>Prepare the Kubernetes environment.</li> <li>Install Istio and start it.</li></ul> <h4 id="_2-obtaining-the-demo-binary-package"><a href="#_2-obtaining-the-demo-binary-package" class="header-anchor">#</a> 2 Obtaining the Demo Binary Package</h4> <p>Extract the binary package to get the <code>product/</code> directory files.</p> <h4 id="_3-starting-the-spring-server"><a href="#_3-starting-the-spring-server" class="header-anchor">#</a> 3 Starting the spring-server</h4> <p>Enter the product/spring-server directory:</p> <ol><li><p>Execute the following command to package the spring-server image:</p> <div class="language- extra-class"><pre class="language-text"><code>sh build-server.sh
</code></pre></div></li> <li><p>Execute the following command to run the spring-server pod and service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f spring-server.yaml
</code></pre></div></li></ol> <h4 id="_4-starting-the-spring-client"><a href="#_4-starting-the-spring-client" class="header-anchor">#</a> 4 Starting the spring-client</h4> <p>Enter the product/spring-client directory:</p> <ol><li><p>Execute the following command to package the spring-client image:</p> <div class="language- extra-class"><pre class="language-text"><code>sh build-client.sh
</code></pre></div></li> <li><p>Execute the following command to run the spring-client instance and service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f spring-client.yaml
</code></pre></div></li></ol> <h4 id="_5-verification"><a href="#_5-verification" class="header-anchor">#</a> 5 Verification</h4> <p>Access the spring-client microservice via a web page, set the input parameter <code>address</code> to empty, and verify whether Sermant can successfully call the upstream service spring-server:</p> <div class="language- extra-class"><pre class="language-text"><code>http://127.0.0.1:30110/hello?address=
</code></pre></div><p>The webpage shows the following message, indicating that Sermant successfully discovered the instance of spring-server and modified the <code>address</code> parameter to the correct spring-server instance address:</p> <div class="language- extra-class"><pre class="language-text"><code>Greetings from http://xxx.xxx.xxx.xxx:8080 : hello, the current time is 2050-01-01T02:08:08.369
</code></pre></div><h3 id="routing-example-based-on-xds-service"><a href="#routing-example-based-on-xds-service" class="header-anchor">#</a> Routing Example Based on xDS Service</h3> <p>This tutorial demonstrates Sermant's routing capabilities based on xDS service using the <code>xds-router-demo</code> from the <a href="https://github.com/sermant-io/Sermant-examples/tree/main/xds-router-demo" target="_blank" rel="noopener noreferrer">Sermant-examples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> repository. The demo includes two microservices: <code>spring-client</code> and <code>spring-server</code>. The <code>spring-client</code> microservice starts with the Sermant routing plugin and enables xDS-based routing capabilities. When the <code>spring-client</code> calls upstream services, the Sermant routing plugin routes the requests based on the upstream service’s routing rules, selecting the appropriate service instance that meets the rules.</p> <h4 id="_1-preparation"><a href="#_1-preparation" class="header-anchor">#</a> 1. Preparation</h4> <ul><li><a href="https://github.com/sermant-io/Sermant-examples/releases/download/v2.1.0/sermant-examples-xds-router-demo-2.1.0.tar.gz" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> the demo binary artifact package.</li> <li><a href="https://github.com/sermant-io/Sermant/releases/download/v2.1.0/sermant-2.1.0.tar.gz" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> the Sermant binary artifact package.</li> <li>Prepare a Kubernetes environment.</li> <li>Install and start <a href="https://istio.io/latest/docs/setup/getting-started/" target="_blank" rel="noopener noreferrer">Istio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ul> <h4 id="_2-obtain-the-demo-binary-artifacts"><a href="#_2-obtain-the-demo-binary-artifacts" class="header-anchor">#</a> 2. Obtain the Demo Binary Artifacts</h4> <p>Unzip the demo binary artifact package to get the <code>router-product/</code> directory.</p> <h4 id="_3-obtain-and-move-the-sermant-binary-artifacts"><a href="#_3-obtain-and-move-the-sermant-binary-artifacts" class="header-anchor">#</a> 3. Obtain and Move the Sermant Binary Artifacts</h4> <p>Unzip the Sermant binary artifact package to get the <code>sermant-agent/</code> directory.</p> <p>Run the following command to move the Sermant binary artifacts to the <code>spring-client</code> directory for packaging the <code>spring-client</code> image:</p> <div class="language- extra-class"><pre class="language-text"><code>cp -r ${sermant-path}/sermant-agent/agent ${demo-path}/router-product/spring-client
</code></pre></div><blockquote><p>Note: <code>${sermant-path}</code> is the path to the Sermant binary artifacts, and <code>${demo-path}</code> is the path to the demo binary artifacts.</p></blockquote> <h4 id="_4-start-spring-server"><a href="#_4-start-spring-server" class="header-anchor">#</a> 4. Start <code>spring-server</code></h4> <p>Navigate to the <code>router-product/spring-server</code> directory:</p> <ol><li><p>Run the following command to package the <code>spring-server</code> image:</p> <div class="language- extra-class"><pre class="language-text"><code>sh build-server.sh
</code></pre></div></li> <li><p>Run the following command to deploy the <code>spring-server</code> Pod and Service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f ../script/spring-server.yaml
</code></pre></div></li></ol> <h4 id="_5-start-spring-client"><a href="#_5-start-spring-client" class="header-anchor">#</a> 5. Start <code>spring-client</code></h4> <p>Navigate to the <code>product/spring-client</code> directory:</p> <ol><li><p>Run the following command to package the <code>spring-client</code> image:</p> <div class="language- extra-class"><pre class="language-text"><code>sh build-client.sh
</code></pre></div></li> <li><p>Run the following command to deploy the <code>spring-client</code> Pod and Service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f ../script/spring-client.yaml
</code></pre></div></li></ol> <h4 id="_6-apply-routing-rules"><a href="#_6-apply-routing-rules" class="header-anchor">#</a> 6. Apply Routing Rules</h4> <p>Navigate to the <code>product/script</code> directory and apply the routing rules by running the following commands:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f spring-server-destination.yaml
kubectl apply -f spring-server-virtureservice.yaml
</code></pre></div><blockquote><p><strong>Routing Rules Explanation</strong>:</p> <ul><li><strong>DestinationRule</strong>: Divides the Pods into two subsets, <code>v1</code> and <code>v2</code>, based on the <code>version</code> label of the Deployment. The <code>spring-server</code> cluster uses the <code>ROUND_ROBIN</code> load balancing strategy.</li> <li><strong>VirtualService</strong>: Routes HTTP requests to the <code>spring-server</code> service to the <code>v1</code> subset if the request contains the <code>version:v1</code> header and the request path is <code>/router</code>.</li></ul></blockquote> <h4 id="_7-verification"><a href="#_7-verification" class="header-anchor">#</a> 7. Verification</h4> <p>Access the <code>spring-client</code> microservice via a web browser, set the <code>host</code> parameter to <code>spring-server</code>, and set <code>version</code>to <code>v1</code>. Verify that the <code>spring-client</code> successfully calls the <code>v1</code> version of the upstream <code>spring-server</code> service:</p> <div class="language- extra-class"><pre class="language-text"><code>http://127.0.0.1:30110/router/httpClient?host=spring-server&amp;version=v1
</code></pre></div><p>If the web page displays the following output, it indicates that <code>spring-client</code> successfully called the <code>v1</code> version of the <code>spring-server</code> service:</p> <div class="language- extra-class"><pre class="language-text"><code>spring-server version: v1
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/15/2024, 11:22:38 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/document/user-guide/configuration-center.html" class="prev">
        Dynamic Configuration Center User Manual
      </a></span> <span class="next"><a href="/en/document/user-guide/injector.html">
        Sermant Injector User Manual
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5c3a2ada.js" defer></script><script src="/assets/js/3.06f127bc.js" defer></script><script src="/assets/js/1.c8bacf5b.js" defer></script><script src="/assets/js/65.872254de.js" defer></script><script src="/assets/js/14.199c38f6.js" defer></script>
  </body>
</html>
