<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Heartbeat Function | Sermant</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.svg">
    <meta name="description" content="A Proxyless Service Mesh based on Bytecode Enhancement">
    
    <link rel="preload" href="/assets/css/0.styles.b3162cc2.css" as="style"><link rel="preload" href="/assets/js/app.9f1d7790.js" as="script"><link rel="preload" href="/assets/js/3.5623409f.js" as="script"><link rel="preload" href="/assets/js/1.b15421ba.js" as="script"><link rel="preload" href="/assets/js/13.86a0f1e9.js" as="script"><link rel="prefetch" href="/assets/js/10.cfbef995.js"><link rel="prefetch" href="/assets/js/100.1a83f88d.js"><link rel="prefetch" href="/assets/js/101.3eedcd7b.js"><link rel="prefetch" href="/assets/js/102.b5e09321.js"><link rel="prefetch" href="/assets/js/103.2dd18e5f.js"><link rel="prefetch" href="/assets/js/104.442505cf.js"><link rel="prefetch" href="/assets/js/105.ee4514a0.js"><link rel="prefetch" href="/assets/js/106.846fd371.js"><link rel="prefetch" href="/assets/js/107.d4b84b60.js"><link rel="prefetch" href="/assets/js/108.0909028f.js"><link rel="prefetch" href="/assets/js/109.d625ca1d.js"><link rel="prefetch" href="/assets/js/11.60305907.js"><link rel="prefetch" href="/assets/js/110.3fdc62e2.js"><link rel="prefetch" href="/assets/js/111.ef8cbe48.js"><link rel="prefetch" href="/assets/js/112.786e00d4.js"><link rel="prefetch" href="/assets/js/113.3a6cd601.js"><link rel="prefetch" href="/assets/js/114.0cd0adff.js"><link rel="prefetch" href="/assets/js/12.34d38cf9.js"><link rel="prefetch" href="/assets/js/14.095e6b30.js"><link rel="prefetch" href="/assets/js/15.e73a6d7c.js"><link rel="prefetch" href="/assets/js/16.fec41699.js"><link rel="prefetch" href="/assets/js/17.f476faab.js"><link rel="prefetch" href="/assets/js/18.f406bc1c.js"><link rel="prefetch" href="/assets/js/19.ca964182.js"><link rel="prefetch" href="/assets/js/20.9066a7e1.js"><link rel="prefetch" href="/assets/js/21.641c7801.js"><link rel="prefetch" href="/assets/js/22.9a7f3465.js"><link rel="prefetch" href="/assets/js/23.97cb668f.js"><link rel="prefetch" href="/assets/js/24.c2865696.js"><link rel="prefetch" href="/assets/js/25.ece41e63.js"><link rel="prefetch" href="/assets/js/26.7b323e16.js"><link rel="prefetch" href="/assets/js/27.6dcf2105.js"><link rel="prefetch" href="/assets/js/28.3a71d01d.js"><link rel="prefetch" href="/assets/js/29.b0ddb50b.js"><link rel="prefetch" href="/assets/js/30.29bbec41.js"><link rel="prefetch" href="/assets/js/31.94f98f6a.js"><link rel="prefetch" href="/assets/js/32.9179c939.js"><link rel="prefetch" href="/assets/js/33.cebc78f2.js"><link rel="prefetch" href="/assets/js/34.06c41d07.js"><link rel="prefetch" href="/assets/js/35.6e9d2175.js"><link rel="prefetch" href="/assets/js/36.0659e1c9.js"><link rel="prefetch" href="/assets/js/37.9ee0a8bf.js"><link rel="prefetch" href="/assets/js/38.c799c1e9.js"><link rel="prefetch" href="/assets/js/39.eda52258.js"><link rel="prefetch" href="/assets/js/4.1f7cf31c.js"><link rel="prefetch" href="/assets/js/40.178bf55f.js"><link rel="prefetch" href="/assets/js/41.e3b351a9.js"><link rel="prefetch" href="/assets/js/42.aa7440af.js"><link rel="prefetch" href="/assets/js/43.22c3a611.js"><link rel="prefetch" href="/assets/js/44.bea27146.js"><link rel="prefetch" href="/assets/js/45.0bb4b5a0.js"><link rel="prefetch" href="/assets/js/46.97fbea63.js"><link rel="prefetch" href="/assets/js/47.e3c0e87b.js"><link rel="prefetch" href="/assets/js/48.e2216aa1.js"><link rel="prefetch" href="/assets/js/49.542faebd.js"><link rel="prefetch" href="/assets/js/5.27b946c4.js"><link rel="prefetch" href="/assets/js/50.eec0fcc8.js"><link rel="prefetch" href="/assets/js/51.36e67330.js"><link rel="prefetch" href="/assets/js/52.cd80e161.js"><link rel="prefetch" href="/assets/js/53.6105c07a.js"><link rel="prefetch" href="/assets/js/54.7551e07a.js"><link rel="prefetch" href="/assets/js/55.0485f657.js"><link rel="prefetch" href="/assets/js/56.5e4c4198.js"><link rel="prefetch" href="/assets/js/57.5c974e62.js"><link rel="prefetch" href="/assets/js/58.a1110b96.js"><link rel="prefetch" href="/assets/js/59.715330b7.js"><link rel="prefetch" href="/assets/js/6.a6913bc1.js"><link rel="prefetch" href="/assets/js/60.4a0c70d2.js"><link rel="prefetch" href="/assets/js/61.48be7856.js"><link rel="prefetch" href="/assets/js/62.b66cd57e.js"><link rel="prefetch" href="/assets/js/63.3bf5da9f.js"><link rel="prefetch" href="/assets/js/64.5c87a987.js"><link rel="prefetch" href="/assets/js/65.454a0222.js"><link rel="prefetch" href="/assets/js/66.1d907639.js"><link rel="prefetch" href="/assets/js/67.3bf031f0.js"><link rel="prefetch" href="/assets/js/68.f23d7700.js"><link rel="prefetch" href="/assets/js/69.db808a64.js"><link rel="prefetch" href="/assets/js/7.d018164a.js"><link rel="prefetch" href="/assets/js/70.ae68765e.js"><link rel="prefetch" href="/assets/js/71.0dfbb3ed.js"><link rel="prefetch" href="/assets/js/72.b197b453.js"><link rel="prefetch" href="/assets/js/73.a14aa5c0.js"><link rel="prefetch" href="/assets/js/74.f81b17b5.js"><link rel="prefetch" href="/assets/js/75.202cac83.js"><link rel="prefetch" href="/assets/js/76.ad81da3b.js"><link rel="prefetch" href="/assets/js/77.f806eb9a.js"><link rel="prefetch" href="/assets/js/78.fcbd0aa6.js"><link rel="prefetch" href="/assets/js/79.61af2601.js"><link rel="prefetch" href="/assets/js/8.10750ce9.js"><link rel="prefetch" href="/assets/js/80.e7003560.js"><link rel="prefetch" href="/assets/js/81.02d240b7.js"><link rel="prefetch" href="/assets/js/82.ba92673b.js"><link rel="prefetch" href="/assets/js/83.75153477.js"><link rel="prefetch" href="/assets/js/84.e0e51527.js"><link rel="prefetch" href="/assets/js/85.2692d845.js"><link rel="prefetch" href="/assets/js/86.88f0e72a.js"><link rel="prefetch" href="/assets/js/87.d0423727.js"><link rel="prefetch" href="/assets/js/88.4091d482.js"><link rel="prefetch" href="/assets/js/89.9c641592.js"><link rel="prefetch" href="/assets/js/9.4d2ce84a.js"><link rel="prefetch" href="/assets/js/90.7009bcbf.js"><link rel="prefetch" href="/assets/js/91.3617cc72.js"><link rel="prefetch" href="/assets/js/92.d5c4781c.js"><link rel="prefetch" href="/assets/js/93.5c15a2b6.js"><link rel="prefetch" href="/assets/js/94.510f5827.js"><link rel="prefetch" href="/assets/js/95.3cadcd1a.js"><link rel="prefetch" href="/assets/js/96.3d5a7e8a.js"><link rel="prefetch" href="/assets/js/97.a9a67bb3.js"><link rel="prefetch" href="/assets/js/98.5353c6f2.js"><link rel="prefetch" href="/assets/js/99.bbcb6377.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b3162cc2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/img/sermant-logo.png" alt="Sermant" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/developer-guide/heartbeat-func.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/developer-guide/heartbeat-func.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/developer-guide/heartbeat-func.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/developer-guide/heartbeat-func.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>User Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Plugin Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Developer Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/document/developer-guide/" aria-current="page" class="sidebar-link">Create Your First Plugin</a></li><li><a href="/en/document/developer-guide/bytecode-enhancement.html" class="sidebar-link">Bytecode Enhancement</a></li><li><a href="/en/document/developer-guide/package-structure.html" class="sidebar-link">Plugin Structure</a></li><li><a href="/en/document/developer-guide/plugin-configuration.html" class="sidebar-link">Plugin Configuration</a></li><li><a href="/en/document/developer-guide/dynamic-config-func.html" class="sidebar-link">Dynamic Configuration Function</a></li><li><a href="/en/document/developer-guide/sermant-xds-service.html" class="sidebar-link">xDS Service</a></li><li><a href="/en/document/developer-guide/heartbeat-func.html" aria-current="page" class="active sidebar-link">Heartbeat Function</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/document/developer-guide/heartbeat-func.html#function-introduction" class="sidebar-link">Function Introduction</a></li><li class="sidebar-sub-header"><a href="/en/document/developer-guide/heartbeat-func.html#development-example" class="sidebar-link">Development Example</a></li><li class="sidebar-sub-header"><a href="/en/document/developer-guide/heartbeat-func.html#api-configuration" class="sidebar-link">API &amp; Configuration</a></li></ul></li><li><a href="/en/document/developer-guide/trace-tracking-func.html" class="sidebar-link">Link Function</a></li><li><a href="/en/document/developer-guide/log-func.html" class="sidebar-link">Logging Function</a></li><li><a href="/en/document/developer-guide/third-party-copyright.html" class="sidebar-link">Third Party Copyright Statement</a></li><li><a href="/en/document/developer-guide/version-manage.html" class="sidebar-link">Version Management</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Community Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="heartbeat-function"><a href="#heartbeat-function" class="header-anchor">#</a> Heartbeat Function</h1> <p>This article shows you how to use the heartbeat feature provided by Sermant in your development.</p> <h2 id="function-introduction"><a href="#function-introduction" class="header-anchor">#</a> Function Introduction</h2> <p>The heartbeat function plays a key role in the field of microservice governance. The heartbeat mechanism is used to monitor the status of each service instance, and the heartbeat is periodically reported to inform other services of its own survival status to avoid exceptions caused by instance downtime.</p> <p>The <strong>Sermant</strong> reports the metadata of the service instance to <strong>Backend</strong> through the heartbeat. It also reports information about the loaded service governance plug-ins to inform <strong>Backend</strong> which service governance plug-ins are carried by the <strong>Sermant Agent</strong>. The <strong>Backend</strong> monitoring panel displays service instances that carry <strong>Sermant Agents</strong>.</p> <blockquote><p>Attention: The heartbeat function must be used with the Backend monitoring panel. For details, see the <a href="/en/document/user-guide/backend.html">Backend User Manual</a>.</p></blockquote> <h2 id="development-example"><a href="#development-example" class="header-anchor">#</a> Development Example</h2> <p>The development based on heartbeat capability is mainly used to allow plug-in developers to report a small amount of very important information of plug-ins through heartbeat, and can be observed in the monitoring panel. This development example is based on the project created in the documentation for <a href="/en/document/developer-guide/" class="router-link-active">Create your first plugin</a>.</p> <p>In engineering <code>template\template-plugin</code> module under <code>com.huaweicloud.sermant.template.TemplateDeclarer</code> class add variable <code>heartbeatService</code> framework for the heart service, This parameter is used to set additional heartbeat information：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">HeartbeatService</span> heartbeatService <span class="token operator">=</span> <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">HeartbeatService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the <code>before</code> method of <a href="/en/document/developer-guide/bytecode-enhancement.html#Interceptor">Interceptor</a> for the<code>main</code> method, set the heartbeat extra information via the <code>setExtInfo</code> interface:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ExecuteContext</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">ExecuteContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  heartbeatService<span class="token punctuation">.</span><span class="token function">setExtInfo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Good morning!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>After the development is complete, you can follow the <a href="/en/document/developer-guide/#Packaged-build">Packaged build</a> process when
creating the first plug-in, execute the <code>mvn package</code> under the project root directory</li> <li>refer to <a href="/en/document/user-guide/backend.html">Backend User Manual</a> Starts backend.</li> <li>Set the heartbeat switch <code>agent.service.heartbeat.enable</code> to <code>true</code> in file <code>agent/config/config.properties</code>:</li></ol> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># Heartbeat service switch</span>
<span class="token key attr-name">agent.service.heartbeat.enable</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</code></pre></div><ol start="5"><li>Finally, access <code>http://localhost:8900</code> to view Backend.</li></ol> <p><img src="/assets/img/backend_sermant_info.f7f6f546.png" alt="pic"></p> <p>As you can see from the figure, there is currently one instance carrying <strong>Sermant Agent</strong>, and it is running
properly, and it carries version <code>1.2.0</code> of the <code>template</code> plugin.</p> <blockquote><p><strong>Sermant Agent</strong> sends heartbeats to <strong>Backend</strong> on a regular basis. <strong>Backend</strong> will renew the heartbeats received from each <strong>Sermant Agent</strong>, and if they exceed the valid time (can be modified by <a href="/en/document/user-guide/backend.html#Backend-Parameter-Configuration">Backend Parameter Configuration</a>). If a heartbeat has not been reported from a node, the node is set to be lost.</p></blockquote> <h2 id="api-configuration"><a href="#api-configuration" class="header-anchor">#</a> API &amp; Configuration</h2> <h3 id="api"><a href="#api" class="header-anchor">#</a> API</h3> <p><strong>Get The Heartbeat Service</strong></p> <p>Get the heartbeat service object, which is used to add additional information to the plug-in heartbeat data. This service is initialized by the framework and can be directly accessed by the plug-in.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">HeartbeatService</span> heartbeatService <span class="token operator">=</span> <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">HeartbeatService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Add Additional Information About Heartbeat</strong></p> <p>Developers can add additional information about the heartbeat to the plugin as follows:</p> <div class="language-java extra-class"><pre class="language-java"><code>heartbeatService<span class="token punctuation">.</span><span class="token function">setExtInfo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h3> <p>Based on the <a href="/en/document/developer-guide/#Project-structure">Project structure</a> created in the first plugin, the heartbeat configuration is set by modifying the <code>config/config.properties</code> file.</p> <table><thead><tr><th>Configuration Items</th> <th>Description</th> <th>Example Configuration</th></tr></thead> <tbody><tr><td>heartbeat.interval</td> <td>Heartbeat sending interval time in ms</td> <td>heartbeat.interval=30000</td></tr></tbody></table></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/10/2024, 10:16:06 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/document/developer-guide/sermant-xds-service.html" class="prev">
        xDS Service
      </a></span> <span class="next"><a href="/en/document/developer-guide/trace-tracking-func.html">
        Link Function
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9f1d7790.js" defer></script><script src="/assets/js/3.5623409f.js" defer></script><script src="/assets/js/1.b15421ba.js" defer></script><script src="/assets/js/13.86a0f1e9.js" defer></script>
  </body>
</html>
