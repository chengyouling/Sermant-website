<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Outlier instance removal | Sermant</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.svg">
    <meta name="description" content="A Proxyless Service Mesh Solution Based on JavaAgent">
    
    <link rel="preload" href="/assets/css/0.styles.a72ad1e6.css" as="style"><link rel="preload" href="/assets/js/app.95798f9b.js" as="script"><link rel="preload" href="/assets/js/3.0215ffee.js" as="script"><link rel="preload" href="/assets/js/1.b15421ba.js" as="script"><link rel="preload" href="/assets/js/50.6e3d89db.js" as="script"><link rel="preload" href="/assets/js/15.e73a6d7c.js" as="script"><link rel="prefetch" href="/assets/js/10.3bbc2b94.js"><link rel="prefetch" href="/assets/js/100.fa2e5115.js"><link rel="prefetch" href="/assets/js/101.4fec3f16.js"><link rel="prefetch" href="/assets/js/11.60305907.js"><link rel="prefetch" href="/assets/js/12.34d38cf9.js"><link rel="prefetch" href="/assets/js/13.7c01cbc4.js"><link rel="prefetch" href="/assets/js/14.46570ac0.js"><link rel="prefetch" href="/assets/js/16.fec41699.js"><link rel="prefetch" href="/assets/js/17.8c863cad.js"><link rel="prefetch" href="/assets/js/18.0eeef45d.js"><link rel="prefetch" href="/assets/js/19.089fd575.js"><link rel="prefetch" href="/assets/js/20.32a742b7.js"><link rel="prefetch" href="/assets/js/21.bf8bcc33.js"><link rel="prefetch" href="/assets/js/22.7e7553bf.js"><link rel="prefetch" href="/assets/js/23.4b945458.js"><link rel="prefetch" href="/assets/js/24.1f8fc570.js"><link rel="prefetch" href="/assets/js/25.59f3433d.js"><link rel="prefetch" href="/assets/js/26.774c7952.js"><link rel="prefetch" href="/assets/js/27.9a6f3221.js"><link rel="prefetch" href="/assets/js/28.58716e75.js"><link rel="prefetch" href="/assets/js/29.7541a225.js"><link rel="prefetch" href="/assets/js/30.5eae550a.js"><link rel="prefetch" href="/assets/js/31.9486d5ff.js"><link rel="prefetch" href="/assets/js/32.8f6c8568.js"><link rel="prefetch" href="/assets/js/33.0a0b97e8.js"><link rel="prefetch" href="/assets/js/34.3f95c680.js"><link rel="prefetch" href="/assets/js/35.0426ebb0.js"><link rel="prefetch" href="/assets/js/36.b45bf902.js"><link rel="prefetch" href="/assets/js/37.963b608b.js"><link rel="prefetch" href="/assets/js/38.18e47322.js"><link rel="prefetch" href="/assets/js/39.03a766c9.js"><link rel="prefetch" href="/assets/js/4.b5e11e65.js"><link rel="prefetch" href="/assets/js/40.5f6270c6.js"><link rel="prefetch" href="/assets/js/41.2c1df2d6.js"><link rel="prefetch" href="/assets/js/42.01bf6dd7.js"><link rel="prefetch" href="/assets/js/43.a3d2f99b.js"><link rel="prefetch" href="/assets/js/44.bc44adc1.js"><link rel="prefetch" href="/assets/js/45.2892653a.js"><link rel="prefetch" href="/assets/js/46.8cd93187.js"><link rel="prefetch" href="/assets/js/47.ef0dd494.js"><link rel="prefetch" href="/assets/js/48.b3d70f0d.js"><link rel="prefetch" href="/assets/js/49.b0a3dd91.js"><link rel="prefetch" href="/assets/js/5.23d7ebee.js"><link rel="prefetch" href="/assets/js/51.98baca71.js"><link rel="prefetch" href="/assets/js/52.5a6e81cb.js"><link rel="prefetch" href="/assets/js/53.0ea21dac.js"><link rel="prefetch" href="/assets/js/54.8cbcc4cc.js"><link rel="prefetch" href="/assets/js/55.d3e408f1.js"><link rel="prefetch" href="/assets/js/56.279ad927.js"><link rel="prefetch" href="/assets/js/57.26146a67.js"><link rel="prefetch" href="/assets/js/58.df548f4e.js"><link rel="prefetch" href="/assets/js/59.d11b2a2c.js"><link rel="prefetch" href="/assets/js/6.35af72fa.js"><link rel="prefetch" href="/assets/js/60.35473c06.js"><link rel="prefetch" href="/assets/js/61.e0f0fadc.js"><link rel="prefetch" href="/assets/js/62.a30b8141.js"><link rel="prefetch" href="/assets/js/63.f924b1c4.js"><link rel="prefetch" href="/assets/js/64.8423cb16.js"><link rel="prefetch" href="/assets/js/65.5200b8cd.js"><link rel="prefetch" href="/assets/js/66.fc5215b6.js"><link rel="prefetch" href="/assets/js/67.5f94af93.js"><link rel="prefetch" href="/assets/js/68.7972e842.js"><link rel="prefetch" href="/assets/js/69.f55cb02e.js"><link rel="prefetch" href="/assets/js/7.65cf686d.js"><link rel="prefetch" href="/assets/js/70.04d90986.js"><link rel="prefetch" href="/assets/js/71.f80e5f7a.js"><link rel="prefetch" href="/assets/js/72.410e3f7f.js"><link rel="prefetch" href="/assets/js/73.471e9686.js"><link rel="prefetch" href="/assets/js/74.db59e196.js"><link rel="prefetch" href="/assets/js/75.60812559.js"><link rel="prefetch" href="/assets/js/76.a34f9101.js"><link rel="prefetch" href="/assets/js/77.ef25f076.js"><link rel="prefetch" href="/assets/js/78.aca3f97a.js"><link rel="prefetch" href="/assets/js/79.e3e5b119.js"><link rel="prefetch" href="/assets/js/8.58cc4695.js"><link rel="prefetch" href="/assets/js/80.9865d857.js"><link rel="prefetch" href="/assets/js/81.43cc63d2.js"><link rel="prefetch" href="/assets/js/82.181a6bb0.js"><link rel="prefetch" href="/assets/js/83.09a211ad.js"><link rel="prefetch" href="/assets/js/84.d16beeda.js"><link rel="prefetch" href="/assets/js/85.e060ae87.js"><link rel="prefetch" href="/assets/js/86.d87015bb.js"><link rel="prefetch" href="/assets/js/87.e12c7f32.js"><link rel="prefetch" href="/assets/js/88.2d913c0f.js"><link rel="prefetch" href="/assets/js/89.621532c9.js"><link rel="prefetch" href="/assets/js/9.ad7e170b.js"><link rel="prefetch" href="/assets/js/90.133935f8.js"><link rel="prefetch" href="/assets/js/91.6f6c5f49.js"><link rel="prefetch" href="/assets/js/92.40fd6b28.js"><link rel="prefetch" href="/assets/js/93.6530ebe2.js"><link rel="prefetch" href="/assets/js/94.960db62e.js"><link rel="prefetch" href="/assets/js/95.f0074afc.js"><link rel="prefetch" href="/assets/js/96.abb935d7.js"><link rel="prefetch" href="/assets/js/97.6d456f2a.js"><link rel="prefetch" href="/assets/js/98.48c8eda0.js"><link rel="prefetch" href="/assets/js/99.f5c124de.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a72ad1e6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/img/sermant-logo.png" alt="Sermant" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/huaweicloud/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/removal.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/removal.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/huaweicloud/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/removal.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/removal.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>User Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Plugin Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/document/plugin/" aria-current="page" class="sidebar-link">Plugin</a></li><li><a href="/en/document/plugin/dynamic-config.html" class="sidebar-link">Dynamic Configuration</a></li><li><a href="/en/document/plugin/flowcontrol.html" class="sidebar-link">FlowControl</a></li><li><a href="/en/document/plugin/graceful.html" class="sidebar-link">Graceful Online/Offline</a></li><li><a href="/en/document/plugin/loadbalancer.html" class="sidebar-link">Load balancing</a></li><li><a href="/en/document/plugin/monitor.html" class="sidebar-link">Monitoring</a></li><li><a href="/en/document/plugin/router.html" class="sidebar-link">Tag Router</a></li><li><a href="/en/document/plugin/register-migration.html" class="sidebar-link">Service-Registry</a></li><li><a href="/en/document/plugin/springboot-registry.html" class="sidebar-link">SpringBoot Registry</a></li><li><a href="/en/document/plugin/visibility.html" class="sidebar-link">Service visibility</a></li><li><a href="/en/document/plugin/removal.html" aria-current="page" class="active sidebar-link">Outlier instance removal</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/document/plugin/removal.html#function-introduction" class="sidebar-link">Function Introduction</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/removal.html#parameter-configuration" class="sidebar-link">Parameter configuration</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/removal.html#detailed-removal-rules" class="sidebar-link">Detailed removal rules</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/removal.html#supported-versions-and-limitations" class="sidebar-link">Supported versions and limitations</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/removal.html#operation-and-result-verification" class="sidebar-link">Operation and result verification</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developer Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Community Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="outlier-instance-removal"><a href="#outlier-instance-removal" class="header-anchor">#</a> Outlier instance removal</h1> <p>This article introduces how to use the <a href="https://github.com/huaweicloud/Sermant/tree/develop/sermant-plugins/sermant-service-removal" target="_blank" rel="noopener noreferrer">Outlier instance removal plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="function-introduction"><a href="#function-introduction" class="header-anchor">#</a> Function Introduction</h2> <p>The outlier instance removal plugin detects the availability of application instances in a non-invasive manner, and performs removal operations on abnormal application instances to ensure service stability. The outlier instance removal plugin will retest the availability of the removed instance after a period of time. If the instance returns to normal, it will not be removed again.</p> <h2 id="parameter-configuration"><a href="#parameter-configuration" class="header-anchor">#</a> Parameter configuration</h2> <h3 id="plugin-configuration"><a href="#plugin-configuration" class="header-anchor">#</a> Plugin Configuration</h3> <p>The outlier instance removal plugin requires configuration of the outlier instance removal plugin switch (<code>remove.config.enableRemoval</code>), instance call information expiration time (<code>remove.config.expireTime</code>), service call exceptions supported by the plugin (<code>remove.config.exceptions</code>), recovery time after instance removal (<code>remove.config.recoveryTime</code>), and outlier instance removal rules (<code>remove.config.rules</code>), The configuration file for the plugin can be found in <code>${path}/sermant-agent-x.x.x/agent/pluginPackage/service-removal/config/config.yaml</code>, as shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Outlier instance removal plugin configuration</span>
<span class="token key atrule">removal.config</span><span class="token punctuation">:</span>
  <span class="token key atrule">expireTime</span><span class="token punctuation">:</span> <span class="token number">60000</span>         <span class="token comment"># The expiration time of instance call information. Unit: milliseconds</span>
  <span class="token key atrule">exceptions</span><span class="token punctuation">:</span>               <span class="token comment"># Service invocation exceptions supported by plugins</span>
    <span class="token punctuation">-</span> com.alibaba.dubbo.remoting.TimeoutException
    <span class="token punctuation">-</span> org.apache.dubbo.remoting.TimeoutException
    <span class="token punctuation">-</span> java.util.concurrent.TimeoutException
    <span class="token punctuation">-</span> java.net.SocketTimeoutException
  <span class="token key atrule">enableRemoval</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token comment"># Outlier instance removal switch</span>
  <span class="token key atrule">recoveryTime</span><span class="token punctuation">:</span> <span class="token number">30000</span>       <span class="token comment"># Recovery time after instance removal</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>                    <span class="token comment"># Outlier instance removal rules, key: Service name (default rule applies to all services), scaleUpLimit: The upper limit of the outlier instance removal ratio. MinInstanceNum: The minimum number of instances.</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>rule<span class="token punctuation">,</span> <span class="token key atrule">scaleUpLimit</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token key atrule">minInstanceNum</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token key atrule">errorRate</span><span class="token punctuation">:</span> <span class="token number">0.6</span> <span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th style="text-align:left;">Parameter key</th> <th style="text-align:left;">Description</th> <th style="text-align:left;">Default value</th> <th style="text-align:left;">Is it required</th></tr></thead> <tbody><tr><td style="text-align:left;">removal.config.expireTime</td> <td style="text-align:left;">Instance call information expiration time</td> <td style="text-align:left;">60000</td> <td style="text-align:left;">Yes</td></tr> <tr><td style="text-align:left;">removal.config.exceptions</td> <td style="text-align:left;">Service call exceptions supported by plugins</td> <td style="text-align:left;">com. alibaba. dubbo. remoting. TimeoutException<br>org. apache. dubo. remoting. TimeoutException<br>java. util. concurrent. TimeoutException<br>java. net. SocketTimeoutException</td> <td style="text-align:left;">Yes</td></tr> <tr><td style="text-align:left;">removal.config.enableRemoval</td> <td style="text-align:left;">Switch for instance removal plugins</td> <td style="text-align:left;">false</td> <td style="text-align:left;">Yes</td></tr> <tr><td style="text-align:left;">removal.config.recoveryTime</td> <td style="text-align:left;">Recovery time after instance removal</td> <td style="text-align:left;">30000</td> <td style="text-align:left;">Yes</td></tr> <tr><td style="text-align:left;">removal.config.rules</td> <td style="text-align:left;">Outlier instance removal rules:<br>key: service name (valid for all services when default rule is set)<br>scaleUpLimit: upper limit of outlier instance removal ratio<br>minInstanceNum: minimum number of instances</td> <td style="text-align:left;">{key: default rule, scaleUpLimit: 0.6, minInstanceNum: 1, errorRate: 0.6}</td> <td style="text-align:left;">Yes</td></tr></tbody></table> <h2 id="detailed-removal-rules"><a href="#detailed-removal-rules" class="header-anchor">#</a> Detailed removal rules</h2> <p>The outlier instance extraction plugin also supports configuration publishing based on the dynamic configuration center. For configuration publishing, please refer to the <a href="/en/document/user-guide/configuration-center.html#publish-configuration">Dynamic Configuration Center User Manual</a>.</p> <p>The key value is <strong>servant.remove.config</strong>. The group value is <strong>app=${service.meta.application}&amp;environment=${service.meta.environment}</strong>, which is the application configuration. For the configuration of service.meta.application and service.meta.environment, please refer to the <a href="/en/document/user-guide/sermant-agent.html#sermant-agent-parameter-configuration">Service Agent User Manual</a>.</p> <blockquote><p><strong>Note:</strong> Application configuration instructions refer to <a href="https://support.huaweicloud.com/devg-cse/cse_devg_0020.html" target="_blank" rel="noopener noreferrer">CSE Configuration Center Overview<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。
The content value is the specific outlier instance extraction rule configuration. The configuration content is as follows:</p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">expireTime</span><span class="token punctuation">:</span> <span class="token number">60000</span>         <span class="token comment"># The expiration time of instance call information. Unit: milliseconds</span>
<span class="token key atrule">exceptions</span><span class="token punctuation">:</span>               <span class="token comment"># Service invocation exceptions supported by plugins</span>
  <span class="token punctuation">-</span> com.alibaba.dubbo.remoting.TimeoutException
  <span class="token punctuation">-</span> org.apache.dubbo.remoting.TimeoutException
  <span class="token punctuation">-</span> java.util.concurrent.TimeoutException
  <span class="token punctuation">-</span> java.net.SocketTimeoutException
<span class="token key atrule">enableRemoval</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token comment"># Outlier instance removal switch</span>
<span class="token key atrule">recoveryTime</span><span class="token punctuation">:</span> <span class="token number">30000</span>       <span class="token comment"># Recovery time after instance removal</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>                    <span class="token comment"># Outlier instance removal rules, key: Service name (default rule applies to all services), scaleUpLimit: The upper limit of the outlier instance removal ratio. MinInstanceNum: The minimum number of instances.</span>
  <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>rule<span class="token punctuation">,</span> <span class="token key atrule">scaleUpLimit</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token key atrule">minInstanceNum</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token key atrule">errorRate</span><span class="token punctuation">:</span> <span class="token number">0.6</span> <span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>Note:</strong> When adding a new configuration, please remove the comments, otherwise it may cause the addition to fail.</p></blockquote> <h2 id="supported-versions-and-limitations"><a href="#supported-versions-and-limitations" class="header-anchor">#</a> Supported versions and limitations</h2> <p>Framework support:</p> <ul><li>SpringBoot 1.5.10. Release and above</li> <li>Dubbo 2.6.x-2.7.x</li></ul> <h2 id="operation-and-result-verification"><a href="#operation-and-result-verification" class="header-anchor">#</a> Operation and result verification</h2> <p>The following will demonstrate how to use the outlier instance extraction plugin to verify the scenario of using the Zookeeper configuration center to configure outlier extraction rules for SpringCloud applications.</p> <h3 id="preparation-work"><a href="#preparation-work" class="header-anchor">#</a> Preparation work</h3> <ul><li><a href="https://github.com/huaweicloud/Sermant-examples/tree/main/removal-demo" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Removal-demo source code</li> <li><a href="https://github.com/huaweicloud/Sermant/releases" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Or compile the Sermant package</li> <li><a href="https://zookeeper.apache.org/releases#download" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> And start zookeeper</li></ul> <blockquote><p><strong>Note:</strong> <a href="/en/document/user-guide/configuration-center.html">Dynamic Configuration Center</a> will be used by default in this scenario. As it is not a core component of this scenario, it will not be further elaborated in this article.</p></blockquote> <h3 id="step-1-compile-and-package-the-demo-application"><a href="#step-1-compile-and-package-the-demo-application" class="header-anchor">#</a> Step 1: Compile and package the demo application</h3> <p>Execute the following command in the <code>${path}/Sermant-examples/removal-demo</code> directory:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows,Linux,mac</span>
mvn clean package
</code></pre></div><p>After successful packaging:
Get <code>rest-consumer-1.0.0.jar</code> in <code>${path}/Sermant-examples/removal-demo/rest-consumer/target</code>.
Get <code>rest-provider-1.0.0.jar</code> in <code>${path}/Sermant-examples/removal-demo/rest-provider/target</code>.</p> <blockquote><p><strong>Note:</strong> ${path} is the path where the demo application is downloaded.</p></blockquote> <h3 id="step-2-modify-the-configuration"><a href="#step-2-modify-the-configuration" class="header-anchor">#</a> Step 2: Modify the configuration</h3> <ul><li>Modify the configuration of the outlier removal plugin, which can be found in <code>${path}/sermant-agent-x.x.x/agent/pluginPackage/service-removal/config/config.yaml</code>.</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">removal.config</span><span class="token punctuation">:</span>
  <span class="token key atrule">expireTime</span><span class="token punctuation">:</span> <span class="token number">60000</span>         <span class="token comment"># The expiration time of instance call information. Unit: milliseconds</span>
  <span class="token key atrule">exceptions</span><span class="token punctuation">:</span>               <span class="token comment"># Service invocation exceptions supported by plugins</span>
    <span class="token punctuation">-</span> com.alibaba.dubbo.remoting.TimeoutException
    <span class="token punctuation">-</span> org.apache.dubbo.remoting.TimeoutException
    <span class="token punctuation">-</span> java.util.concurrent.TimeoutException
    <span class="token punctuation">-</span> java.net.SocketTimeoutException
  <span class="token key atrule">enableRemoval</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>      <span class="token comment"># Outlier instance removal switch</span>
  <span class="token key atrule">recoveryTime</span><span class="token punctuation">:</span> <span class="token number">30000</span>       <span class="token comment"># Recovery time after instance removal</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>                    <span class="token comment"># Outlier instance removal rules, key: Service name (default rule applies to all services), scaleUpLimit: The upper limit of the outlier instance removal ratio. MinInstanceNum: The minimum number of instances.</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>rule<span class="token punctuation">,</span> <span class="token key atrule">scaleUpLimit</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token key atrule">minInstanceNum</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token key atrule">errorRate</span><span class="token punctuation">:</span> <span class="token number">0.6</span> <span class="token punctuation">}</span>
</code></pre></div><h3 id="step-3-start-the-application"><a href="#step-3-start-the-application" class="header-anchor">#</a> Step 3: Start the application</h3> <ul><li>Start the demo application using the following command
(1) Launch Consumer</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Linux</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-Dniws.loadbalancer.availabilityFilteringRule.filterCircuitTripped</span><span class="token operator">=</span>false <span class="token parameter variable">-jar</span> rest-consumer-1.0.0.jar
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Windows</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-Dniws.loadbalancer.availabilityFilteringRule.filterCircuitTripped</span><span class="token operator">=</span>false <span class="token parameter variable">-jar</span> rest-consumer-1.0.0.jar
</code></pre></div><p>(2) Start Producer</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows,Linux,mac</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> rest-provider-1.0.0.jar
</code></pre></div><p>(3) Start the second producer</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows,Linux,mac</span>
<span class="token function">java</span> <span class="token parameter variable">-Dtimeout</span><span class="token operator">=</span><span class="token number">2000</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8006</span> <span class="token parameter variable">-jar</span> rest-provider-1.0.0.jar
</code></pre></div><blockquote><p><strong>Note:</strong> ${path} is the actual installation path of the server, and x.x.x represents a certain version number of the server.</p></blockquote> <h3 id="verification"><a href="#verification" class="header-anchor">#</a> Verification</h3> <p>Always access through browser<code>http://localhost:8005/hello</code> At the beginning, there will be two situations: successful service request and abnormal request. After 30 seconds, the abnormal instance will be removed and the request will continue to be successful. Abnormal instances removed after 30 seconds will recover and request exceptions will reappear.</p> <p>The query effect is shown below:</p> <ul><li>Request successful rendering</li></ul> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <ul><li>Request failure rendering</li></ul> <div class="el-image"><div class="el-image__placeholder"></div><!----></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/8/2023, 9:09:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/document/plugin/visibility.html" class="prev">
        Service visibility
      </a></span> <span class="next"><a href="/en/document/developer-guide/">
        Create Your First Plugin
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.95798f9b.js" defer></script><script src="/assets/js/3.0215ffee.js" defer></script><script src="/assets/js/1.b15421ba.js" defer></script><script src="/assets/js/50.6e3d89db.js" defer></script><script src="/assets/js/15.e73a6d7c.js" defer></script>
  </body>
</html>
