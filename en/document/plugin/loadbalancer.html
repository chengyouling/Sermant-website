<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Load balancing | Sermant</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.svg">
    <meta name="description" content="A Proxyless Service Mesh based on Bytecode Enhancement">
    
    <link rel="preload" href="/assets/css/0.styles.aea4a1e9.css" as="style"><link rel="preload" href="/assets/js/app.7283d6fb.js" as="script"><link rel="preload" href="/assets/js/3.06f127bc.js" as="script"><link rel="preload" href="/assets/js/1.c8bacf5b.js" as="script"><link rel="preload" href="/assets/js/52.346fa80a.js" as="script"><link rel="preload" href="/assets/js/14.199c38f6.js" as="script"><link rel="prefetch" href="/assets/js/10.11126491.js"><link rel="prefetch" href="/assets/js/100.fe565a9f.js"><link rel="prefetch" href="/assets/js/101.75a964a5.js"><link rel="prefetch" href="/assets/js/102.f5b8826b.js"><link rel="prefetch" href="/assets/js/103.70f393c3.js"><link rel="prefetch" href="/assets/js/104.8f53fb0c.js"><link rel="prefetch" href="/assets/js/105.3812faf4.js"><link rel="prefetch" href="/assets/js/106.164f80b3.js"><link rel="prefetch" href="/assets/js/107.da9f194b.js"><link rel="prefetch" href="/assets/js/108.6f001d15.js"><link rel="prefetch" href="/assets/js/109.d0427332.js"><link rel="prefetch" href="/assets/js/11.592204d9.js"><link rel="prefetch" href="/assets/js/110.e66395e3.js"><link rel="prefetch" href="/assets/js/111.bc0af18c.js"><link rel="prefetch" href="/assets/js/112.303db773.js"><link rel="prefetch" href="/assets/js/113.4a55a566.js"><link rel="prefetch" href="/assets/js/114.ad07dce3.js"><link rel="prefetch" href="/assets/js/115.6145b589.js"><link rel="prefetch" href="/assets/js/12.fd6a031f.js"><link rel="prefetch" href="/assets/js/13.7427e98b.js"><link rel="prefetch" href="/assets/js/15.900a8374.js"><link rel="prefetch" href="/assets/js/16.dc00a508.js"><link rel="prefetch" href="/assets/js/17.7bb9b1f6.js"><link rel="prefetch" href="/assets/js/18.0cb1c621.js"><link rel="prefetch" href="/assets/js/19.f3f80c20.js"><link rel="prefetch" href="/assets/js/20.341a6ad9.js"><link rel="prefetch" href="/assets/js/21.5cb4b5ea.js"><link rel="prefetch" href="/assets/js/22.9fae982b.js"><link rel="prefetch" href="/assets/js/23.c7c78153.js"><link rel="prefetch" href="/assets/js/24.d862bfe2.js"><link rel="prefetch" href="/assets/js/25.d2bfc810.js"><link rel="prefetch" href="/assets/js/26.fe2d3037.js"><link rel="prefetch" href="/assets/js/27.09e84572.js"><link rel="prefetch" href="/assets/js/28.2400a5c0.js"><link rel="prefetch" href="/assets/js/29.b0ddb50b.js"><link rel="prefetch" href="/assets/js/30.0da55062.js"><link rel="prefetch" href="/assets/js/31.5a0cda15.js"><link rel="prefetch" href="/assets/js/32.091bfc64.js"><link rel="prefetch" href="/assets/js/33.56d800c8.js"><link rel="prefetch" href="/assets/js/34.d8960a15.js"><link rel="prefetch" href="/assets/js/35.4d936c34.js"><link rel="prefetch" href="/assets/js/36.69b2f3fb.js"><link rel="prefetch" href="/assets/js/37.f1740a13.js"><link rel="prefetch" href="/assets/js/38.c2bf7b2d.js"><link rel="prefetch" href="/assets/js/39.13bbacce.js"><link rel="prefetch" href="/assets/js/4.7add7152.js"><link rel="prefetch" href="/assets/js/40.52b4d8d7.js"><link rel="prefetch" href="/assets/js/41.ee37f503.js"><link rel="prefetch" href="/assets/js/42.c6aa5076.js"><link rel="prefetch" href="/assets/js/43.40e880d7.js"><link rel="prefetch" href="/assets/js/44.7f56be52.js"><link rel="prefetch" href="/assets/js/45.e8a925fc.js"><link rel="prefetch" href="/assets/js/46.a1c61b6e.js"><link rel="prefetch" href="/assets/js/47.4f0a114b.js"><link rel="prefetch" href="/assets/js/48.2ddc52bc.js"><link rel="prefetch" href="/assets/js/49.0d4508d4.js"><link rel="prefetch" href="/assets/js/5.4a333fb7.js"><link rel="prefetch" href="/assets/js/50.e52baf42.js"><link rel="prefetch" href="/assets/js/51.323b9617.js"><link rel="prefetch" href="/assets/js/53.9cfa5608.js"><link rel="prefetch" href="/assets/js/54.910bbc3e.js"><link rel="prefetch" href="/assets/js/55.592a2d6d.js"><link rel="prefetch" href="/assets/js/56.dc709143.js"><link rel="prefetch" href="/assets/js/57.b682688b.js"><link rel="prefetch" href="/assets/js/58.3b83140b.js"><link rel="prefetch" href="/assets/js/59.255861a7.js"><link rel="prefetch" href="/assets/js/6.72029eac.js"><link rel="prefetch" href="/assets/js/60.f1229caf.js"><link rel="prefetch" href="/assets/js/61.292a52c9.js"><link rel="prefetch" href="/assets/js/62.97ede56c.js"><link rel="prefetch" href="/assets/js/63.f049854f.js"><link rel="prefetch" href="/assets/js/64.ba4db5b6.js"><link rel="prefetch" href="/assets/js/65.5917e76d.js"><link rel="prefetch" href="/assets/js/66.e7547192.js"><link rel="prefetch" href="/assets/js/67.6bbfea50.js"><link rel="prefetch" href="/assets/js/68.df035518.js"><link rel="prefetch" href="/assets/js/69.2e143b01.js"><link rel="prefetch" href="/assets/js/7.698dd478.js"><link rel="prefetch" href="/assets/js/70.d0d9e386.js"><link rel="prefetch" href="/assets/js/71.bcdac895.js"><link rel="prefetch" href="/assets/js/72.9490e30b.js"><link rel="prefetch" href="/assets/js/73.9afc2fcf.js"><link rel="prefetch" href="/assets/js/74.cc2dec6d.js"><link rel="prefetch" href="/assets/js/75.83cc918a.js"><link rel="prefetch" href="/assets/js/76.fcbe5122.js"><link rel="prefetch" href="/assets/js/77.6073f5b0.js"><link rel="prefetch" href="/assets/js/78.6b7eb13a.js"><link rel="prefetch" href="/assets/js/79.9e1e5534.js"><link rel="prefetch" href="/assets/js/8.10750ce9.js"><link rel="prefetch" href="/assets/js/80.a56d59b3.js"><link rel="prefetch" href="/assets/js/81.d4686ffc.js"><link rel="prefetch" href="/assets/js/82.4d9eb05e.js"><link rel="prefetch" href="/assets/js/83.00474326.js"><link rel="prefetch" href="/assets/js/84.91df4c67.js"><link rel="prefetch" href="/assets/js/85.d0ba9718.js"><link rel="prefetch" href="/assets/js/86.66fae153.js"><link rel="prefetch" href="/assets/js/87.b2fa207d.js"><link rel="prefetch" href="/assets/js/88.92620478.js"><link rel="prefetch" href="/assets/js/89.2d3fa404.js"><link rel="prefetch" href="/assets/js/9.7f57e4b0.js"><link rel="prefetch" href="/assets/js/90.6e8c155e.js"><link rel="prefetch" href="/assets/js/91.7bbdd4d6.js"><link rel="prefetch" href="/assets/js/92.9b2f5bd1.js"><link rel="prefetch" href="/assets/js/93.3e4d239e.js"><link rel="prefetch" href="/assets/js/94.9cb9cb55.js"><link rel="prefetch" href="/assets/js/95.b4387d26.js"><link rel="prefetch" href="/assets/js/96.7a2c2952.js"><link rel="prefetch" href="/assets/js/97.82e4da43.js"><link rel="prefetch" href="/assets/js/98.51ebe1cd.js"><link rel="prefetch" href="/assets/js/99.1d8e876a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aea4a1e9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/img/sermant-logo.png" alt="Sermant" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/loadbalancer.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/loadbalancer.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/loadbalancer.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/loadbalancer.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>User Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Plugin Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/document/plugin/" aria-current="page" class="sidebar-link">Plugin</a></li><li><a href="/en/document/plugin/dynamic-config.html" class="sidebar-link">Dynamic Configuration</a></li><li><a href="/en/document/plugin/springboot-registry.html" class="sidebar-link">SpringBoot Registry</a></li><li><a href="/en/document/plugin/register-migration.html" class="sidebar-link">Service Registry</a></li><li><a href="/en/document/plugin/flowcontrol.html" class="sidebar-link">Flow Control</a></li><li><a href="/en/document/plugin/graceful.html" class="sidebar-link">Graceful Startup/Shutdown</a></li><li><a href="/en/document/plugin/removal.html" class="sidebar-link">Outlier instance removal</a></li><li><a href="/en/document/plugin/loadbalancer.html" aria-current="page" class="active sidebar-link">Load balancing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/document/plugin/loadbalancer.html#function-introduction" class="sidebar-link">Function introduction</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/loadbalancer.html#parameter-configuration" class="sidebar-link">Parameter configuration</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/loadbalancer.html#detailed-governance-rules" class="sidebar-link">Detailed governance rules</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/loadbalancer.html#supported-versions-and-restrictions" class="sidebar-link">Supported versions and restrictions</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/loadbalancer.html#operation-and-result-verification" class="sidebar-link">Operation and result verification</a></li></ul></li><li><a href="/en/document/plugin/router.html" class="sidebar-link">Tag Router</a></li><li><a href="/en/document/plugin/monitor.html" class="sidebar-link">Monitoring</a></li><li><a href="/en/document/plugin/visibility.html" class="sidebar-link">Service visibility</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developer Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Community Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="load-balancing"><a href="#load-balancing" class="header-anchor">#</a> Load balancing</h1> <p>This article describes how to use <a href="https://github.com/sermant-io/Sermant/tree/develop/sermant-plugins/sermant-loadbalancer" target="_blank" rel="noopener noreferrer">Load balancing plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="function-introduction"><a href="#function-introduction" class="header-anchor">#</a> Function introduction</h2> <p>The load balancing plug-in is mainly used to dynamically modify the load balancing policy of the host application without invasion.</p> <h2 id="parameter-configuration"><a href="#parameter-configuration" class="header-anchor">#</a> Parameter configuration</h2> <h3 id="plug-in-configuration"><a href="#plug-in-configuration" class="header-anchor">#</a> Plug-in configuration</h3> <p>The load balancing plug-in needs to configure the default load balancing policy, whether to force the use of plug-in load balancing and other information. The configuration file of the plug-in can be found in the <code>${path}/sermant-agent-x.x.x/agent/pluginPackage/loadbalancer/config/config.yaml</code>. The configuration is as follows:</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">loadbalancer.plugin</span><span class="token punctuation">:</span>
    <span class="token key atrule">defaultRule</span><span class="token punctuation">:</span>          <span class="token comment"># Default load balancing policy. When no load balancing policy is configured, the default load balancing policy is used.</span>
    <span class="token key atrule">forceUseSermantLb</span><span class="token punctuation">:</span>    <span class="token comment"># Whether to force the use of plug-in load balancing. The load balancing plug-in determines whether to force the modification of the user's load balancing policy through this configuration. The current configuration is only valid for Ribon. Ribon may have its own load balancing configuration. If you do not want to affect your own load balancing configuration, you can set it to false.</span>
    <span class="token key atrule">useCseRule</span><span class="token punctuation">:</span>           <span class="token comment"># Whether to use CSE rules. The load balancing plugin subscribes to different dynamic configuration paths based on whether to use CSE rules.</span>
</code></pre></div><table><thead><tr><th>Parameter key</th> <th>Description</th> <th>Default value</th> <th>Required</th></tr></thead> <tbody><tr><td>Loadbalancer.plugin.defaultRule</td> <td>Default load balancing policy</td> <td>Empty</td> <td>No</td></tr> <tr><td>Loadbalancer.plugin.forceUseServantLb</td> <td>Whether to force the use of plug-in load balancing</td> <td>true</td> <td>No</td></tr> <tr><td>Loadbalancer.plugin.useCseRule</td> <td>Whether to use cse rule</td> <td>true</td> <td>No</td></tr></tbody></table> <h2 id="detailed-governance-rules"><a href="#detailed-governance-rules" class="header-anchor">#</a> Detailed governance rules</h2> <p>The load balancing plug-in publishes the configuration based on the dynamic configuration center. For configuration publishing, please refer to the <a href="/en/document/user-guide/configuration-center.html#publish-configuration">Dynamic Configuration Center User Manual</a>.</p> <p>The dynamic configuration information to be configured for the load balancing plug-in is as follows:</p> <ul><li>servicecomb.matchGroup.xxx: traffic token (dynamically configured key value). It is used to mark the services for which the current business scenario is effective. Its corresponding content is</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">alias</span><span class="token punctuation">:</span> loadbalancer<span class="token punctuation">-</span>rule
<span class="token key atrule">matches</span><span class="token punctuation">:</span>
  <span class="token key atrule">-serviceName</span><span class="token punctuation">:</span> zk<span class="token punctuation">-</span>rest<span class="token punctuation">-</span>provider  <span class="token comment"># Target service name</span>
</code></pre></div><p><code>serviceName</code>is the downstream service name. If the configuration item <code>serviceName</code> is not configured, it will be applied to all microservices. It should be noted that only the <code>serviceName</code> configuration item needs to be configured for this configuration, and other formats need to remain unchanged.</p> <ul><li>servicecomb.loadbalance. xxx: Load balancing rule (dynamically configured key value). It is used to configure the load balancing rules that take effect in specific business scenarios. Its corresponding content is</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">rule</span><span class="token punctuation">:</span> Random
</code></pre></div><blockquote><p>Note: <strong>xxx is the name of the specific business scenario, and the load balancing policy takes effect when the traffic marking and load balancing policy scenarios are consistent</strong>.</p></blockquote> <p>For the range of configuration values, see <strong>Configuration Values</strong> in Table <a href="#supported-versions-and-restrictions">Supported Versions and Restrictions</a>.</p> <p>The load balancing plug-in supports two levels of group configuration by default:</p> <ul><li><p>Microservice level: that is, the value of group is <code>app=default&amp;environment=&amp;service=${yourServiceName}</code>, where <code>${yourServiceName}</code> is the microservice name obtained dynamically, and <code>environment</code> is empty by default. You can refer to <a href="/en/document/user-guide/sermant-agent.html#parameter-configuration-options">Parameter Configuration Method</a> to change <code>app</code> and <code>envrionment</code>.</p></li> <li><p>Application level: that is, the value of group is <code>app=default&amp;environment=</code>, and <code>environment</code> is empty by default. The environment variable configuration method is the same as <strong>microservice level</strong>.</p></li></ul> <h2 id="supported-versions-and-restrictions"><a href="#supported-versions-and-restrictions" class="header-anchor">#</a> Supported versions and restrictions</h2> <table><thead><tr><th>Framework type</th> <th>policy name</th> <th>configuration value/load balancing policy</th> <th>version support</th></tr></thead> <tbody><tr><td>Dubbo</td> <td>Random (dubbo default)</td> <td>Random/RANDOM</td> <td>2.6. x, 2.7. x</td></tr> <tr><td>Dubbo</td> <td>Polling</td> <td>RoundRobin/ROUNDROBIN</td> <td>2.6. x, 2.7. x</td></tr> <tr><td>Dubbo</td> <td>least active</td> <td>leastActive/LEASTACTIVE</td> <td>2.6. x, 2.7. x</td></tr> <tr><td>Dubbo</td> <td>Consistency HASH</td> <td>consistentHash/CONSISTENTHASH</td> <td>2.6. x, 2.7. x</td></tr> <tr><td>Dubbo</td> <td>shortest response time</td> <td>shortestResponse/SHORTESTRESPONSE</td> <td>2.7.7+</td></tr> <tr><td>Spring-cloud-netflix-ribbon</td> <td>region weight (ribbon default)</td> <td>zoneAvoidance/ZONE_ AVOIDANCE</td> <td>ZONE_ AVOIDANCEspring cloud Edgware.x, spring cloud Finchley.x, spring cloud Greenwich.x, spring cloud Hoxton.x</td></tr> <tr><td>Spring-cloud-netflix-ribbon</td> <td>Random</td> <td>Random/RANDOM</td> <td>spring cloud Edgware. x, spring cloud Finchley. x, spring cloud Greenwich. x, spring cloud Hoxton. x</td></tr> <tr><td>Spring-cloud-netflix-ribbon</td> <td>Polling</td> <td>RoundRobin/ROUND_ ROBIN</td> <td>spring cloud Edgware.x, spring cloud Finchley.x, spring cloud Greenwich.x, spring cloud Hoxton.x</td></tr> <tr><td>Spring-cloud-netflix-ribbon</td> <td>Retry</td> <td>retry/RETRY</td> <td>spring cloud Edgware. x, spring cloud Finchley. x, spring cloud Greenwich. x, spring cloud Hoxton. x</td></tr> <tr><td>Spring-cloud-netflix-ribbon</td> <td>Minimum concurrency</td> <td>bestAvailable/BEST_ AVAILABLE</td> <td>spring cloud Edgware.x, spring cloud Finchley.x, spring cloud Greenwich.x, spring cloud Hoxton.x</td></tr> <tr><td>Spring cloud netflix rib</td> <td>filter polling</td> <td>availability filtering/AVAILABILITY_ FILTERING</td> <td>spring cloud Edgware.x, spring cloud Finchley.x, spring cloud Greenwich.x, spring cloud Hoxton.x</td></tr> <tr><td>Spring-cloud-netflix-ribbon</td> <td>Response time weighted</td> <td>ResponseTimeWeighted/RESPONSE_ TIME_ WEIGHTED</td> <td>spring cloud Edgware.x, spring cloud Finchley.x, spring cloud Greenwich.x, spring cloud Hoxton.x</td></tr> <tr><td>Spring-cloud-netflix-ribbon</td> <td>weighted response time</td> <td>weightedResponseTime/WEIGHTED_ RESPONSE_ TIME</td> <td>spring cloud Edgware.x, spring cloud Finchley.x, spring cloud Greenwich.x, spring cloud Hoxton.x</td></tr> <tr><td>Spring-cloud-loadbalancer</td> <td>Polling (loadbalancer default)</td> <td>RoundRobin/ROUND_ ROBIN</td> <td>spring cloud Hoxton.SR10+, spring cloud 2020.0.x, spring cloud 2021.0.x</td></tr> <tr><td>Spring cloud loader</td> <td>random</td> <td>Random/RANDOM</td> <td>spring cloud Hoxton. SR10+, spring cloud 2020.0. x, spring cloud 2021.0. x</td></tr></tbody></table> <h2 id="operation-and-result-verification"><a href="#operation-and-result-verification" class="header-anchor">#</a> Operation and result verification</h2> <p>The following will demonstrate how to use the load balancing plug-in.</p> <h3 id="preparations"><a href="#preparations" class="header-anchor">#</a> Preparations</h3> <ul><li><p><a href="https://github.com/sermant-io/Sermant-examples/tree/main/sermant-template/demo-register" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> demo source code</p></li> <li><p><a href="https://github.com/sermant-io/Sermant/releases" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/compile the sermant package</p></li> <li><p><a href="https://zookeeper.apache.org/releases.html#download" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> And start zookeeper</p></li></ul> <h3 id="step-1-compile-and-package-the-demo-application"><a href="#step-1-compile-and-package-the-demo-application" class="header-anchor">#</a> Step 1: Compile and package the demo application</h3> <p>Execute the following command in the <code>${path}/Sermant-examples/sermant-template/demo-register</code> directory:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mvn clean package
</code></pre></div><p>After successful packaging, you can get the <code>resttemplate-consumer.jar</code> package in <code>${path}/Sermant-examples/sermant-template/demo-register/resttemplate-consumer/target</code>, in <code>${path}/Sermant-examples/ sermant-template/demo-register/resttemplate-provider/target</code> gets <code>resttemplate-provider.jar</code>.</p> <blockquote><p>Note: path is the path where the demo application is downloaded.</p></blockquote> <h3 id="step-2-publish-traffic-tags"><a href="#step-2-publish-traffic-tags" class="header-anchor">#</a> Step 2: Publish traffic tags</h3> <p>Refer to the <a href="/en/document/user-guide/configuration-center.html#publish-configuration">Dynamic Configuration Center User Manual</a> for configuration publishing, and publish the following configuration</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;alias: loadbalancer-rule\n matches:\n- serviceName: zk-rest-provider&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;group&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app=default&amp;environment=&amp;service=zk-rest-consumer&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;servicecomb.matchGroup.testLb&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Take Zookeeper as an example, and use the command line tools provided by Zookeeper for configuration publishing.</p> <ol><li>Execute the following command in the <code>${path}/bin/</code> directory to create the node <code>/app=default&amp;environment=&amp;service=zk-rest-consumer</code></li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># linux mac</span>
./zkCli.sh <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token assign-left variable">service</span><span class="token operator">=</span>zk-rest-consumer

<span class="token comment"># windows</span>
zkCli.cmd <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token assign-left variable">service</span><span class="token operator">=</span>zk-rest-consumer
</code></pre></div><blockquote><p>Note: <code>${path}</code> is the installation directory of zookeeper</p></blockquote> <ol start="2"><li>Execute the following command in the <code>${path}/bin/</code> directory to create nodes <code>/app=default&amp;environment=&amp;service=zk-rest-consumer/servicecomb.matchGroup.testLb</code> and data <code>alias: loadbalancer-rule\n matches:\n- serviceName: zk-rest-provider</code>.</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># linux mac</span>
./zkCli.sh <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span>/servicecomb.routeRule.spring-cloud-router-provider <span class="token string">&quot;alias: loadbalancer-rule
matches:
- serviceName: zk-rest-provider&quot;</span>

<span class="token comment"># windows</span>
zkCli.cmd <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span>/servicecomb.routeRule.spring-cloud-router-provider <span class="token string">&quot;alias: loadbalancer-rule
matches:
- serviceName: zk-rest-provider&quot;</span>
</code></pre></div><h3 id="step-3-publish-matching-load-balancing-rules-take-random-as-an-example"><a href="#step-3-publish-matching-load-balancing-rules-take-random-as-an-example" class="header-anchor">#</a> Step 3: Publish matching load balancing rules (take Random as an example)</h3> <p>Refer to the <a href="/en/document/user-guide/configuration-center.html#publish-configuration">Dynamic Configuration Center User Manual</a> for configuration publishing, and publish the following configuration</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rule: Random&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;group&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app=default&amp;environment=&amp;service=zk-rest-consumer&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;servicecomb.loadbalance.testLb&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Taking zookeeper as an example, use the PrettyZoo tool to publish the load balancing strategy:</p> <p>Take Zookeeper as an example, and use the command line tools provided by Zookeeper for configuration publishing.</p> <ol><li>Execute the following command in the <code>${path}/bin/</code> directory to create nodes <code>/app=default&amp;environment=&amp;service=zk-rest-consumer/servicecomb.loadbalance.testLb</code> and data <code>rule: Random</code></li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># linux mac</span>
./zkCli.sh <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token assign-left variable">service</span><span class="token operator">=</span>zk-rest-consumer/servicecomb.loadbalance.testLb <span class="token string">&quot;rule: Random&quot;</span>

<span class="token comment"># windows</span>
zkCli.cmd <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token assign-left variable">service</span><span class="token operator">=</span>zk-rest-consumer/servicecomb.loadbalance.testLb <span class="token string">&quot;rule: Random&quot;</span>
</code></pre></div><h3 id="step-4-start-the-demo-application"><a href="#step-4-start-the-demo-application" class="header-anchor">#</a> Step 4: Start the demo application</h3> <p>Refer to the following command to start two producers</p> <ul><li>Refer to the following command to start the service provider, the port is 8006</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Linux</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8006</span> <span class="token parameter variable">-jar</span> resttemplate-provider.jar
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Windows</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8006</span> <span class="token parameter variable">-jar</span> resttemplate-provider.jar
</code></pre></div><ul><li>Refer to the following command to start the service provider, the port is 8007</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Linux</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8007</span> <span class="token parameter variable">-jar</span> resttemplate-provider.jar
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Windows</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8007</span> <span class="token parameter variable">-jar</span> resttemplate-provider.jar
</code></pre></div><ul><li>Refer to the following command to start the consumer (one instance is enough), the port is 8005</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Linux</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8005</span> <span class="token parameter variable">-jar</span> resttemplate-consumer.jar
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Windows</span>
<span class="token function">java</span> -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8005</span> <span class="token parameter variable">-jar</span> resttemplate-consumer.jar
</code></pre></div><blockquote><p><strong>illustrate</strong>:
Where path needs to be replaced with the actual installation path of Sermant.
x.x.x represents a Sermant version number.</p></blockquote> <h3 id="verification"><a href="#verification" class="header-anchor">#</a> Verification</h3> <p>After all the above steps are completed, access the interface <a href="http://localhost:8005/hello" target="_blank" rel="noopener noreferrer">http://localhost:8005/hello<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, multiple calls. If 8006 and 8007 are randomly displayed in the returned port information, it means that the random load balancing rule (polling by default) has taken effect.</p> <p>The renderings are as follows:</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <div class="el-image"><div class="el-image__placeholder"></div><!----></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/12/2024, 2:34:52 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/document/plugin/removal.html" class="prev">
        Outlier instance removal
      </a></span> <span class="next"><a href="/en/document/plugin/router.html">
        Tag Router
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7283d6fb.js" defer></script><script src="/assets/js/3.06f127bc.js" defer></script><script src="/assets/js/1.c8bacf5b.js" defer></script><script src="/assets/js/52.346fa80a.js" defer></script><script src="/assets/js/14.199c38f6.js" defer></script>
  </body>
</html>
